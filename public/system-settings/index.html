<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ç³»ç»Ÿè®¾ç½® - SuperEditor</title>
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://unpkg.com/antd@5.21.6/dist/reset.css">
    <!-- Ant Design Icons -->
    <link rel="stylesheet" href="https://unpkg.com/@ant-design/icons@5.4.0/lib/index.css">
    <style>
        :root {
            --primary-color: #2F4F39;
            --primary-hover: #233A2B;
            --primary-light: #7BA89E;
            --background-light: #E6E1D6;
            --text-color: #333;
            --text-secondary: #666;
            --border-color: #d9d9d9;
            --shadow: 0 3px 6px -4px rgba(0,0,0,.12), 0 6px 16px 0 rgba(0,0,0,.08), 0 9px 28px 8px rgba(0,0,0,.05);
            --card-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.03), 0 1px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px 0 rgba(0, 0, 0, 0.02);
            --success-color: #52c41a;
            --warning-color: #faad14;
            --error-color: #ff4d4f;
            --info-color: #1890ff;
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: var(--text-color);
        }

        .app-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
            gap: 24px;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo::before {
            content: 'ğŸ“';
            font-size: 24px;
        }

        .main-nav {
            display: flex;
            align-items: center;
            gap: 0;
            flex: 1;
            justify-content: center;
        }

        .nav-link {
            padding: 8px 16px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            transition: all 0.3s;
            position: relative;
        }

        .nav-link:hover {
            color: var(--primary-color);
            background-color: rgba(47, 79, 57, 0.1);
        }

        .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(47, 79, 57, 0.15);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-name {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .app-content {
            flex: 1;
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        .page-header {
            margin-bottom: 32px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0 0 8px 0;
        }

        .page-subtitle {
            color: var(--text-secondary);
            margin: 0;
            font-size: 14px;
        }

        .btn {
            padding: 6px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: white;
            color: var(--text-color);
            text-decoration: none;
        }

        .btn:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
        }

        .btn-danger {
            background-color: var(--error-color);
            border-color: var(--error-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #d9363e;
            border-color: #d9363e;
        }

        .btn-success {
            background-color: var(--success-color);
            border-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #389e0d;
            border-color: #389e0d;
        }

        .btn-warning {
            background-color: var(--warning-color);
            border-color: var(--warning-color);
            color: white;
        }

        .btn-warning:hover {
            background-color: #d48806;
            border-color: #d48806;
        }

        .btn-sm {
            padding: 4px 8px;
            font-size: 12px;
            height: 24px;
        }

        .btn-secondary {
            background-color: white;
            border-color: var(--border-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #f5f5f5;
            border-color: var(--primary-light);
        }

        /* Hamburger menu styles */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .menu-toggle:hover {
            background-color: rgba(47, 79, 57, 0.1);
        }

        /* Mobile menu styles */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 64px;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            z-index: 200;
            max-height: calc(100vh - 64px);
            overflow-y: auto;
        }

        .mobile-menu.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .mobile-nav-link {
            display: block;
            padding: 12px 24px;
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .mobile-nav-link:hover {
            background-color: rgba(47, 79, 57, 0.1);
            color: var(--primary-color);
        }

        .mobile-nav-link:last-child {
            border-bottom: none;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* Settings Layout */
        .settings-container {
            display: grid;
            grid-template-columns: 280px 1fr;
            gap: 24px;
        }

        .settings-sidebar {
            background: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            height: fit-content;
            position: sticky;
            top: 88px;
        }

        .settings-nav {
            padding: 8px 0;
        }

        .settings-nav-item {
            padding: 10px 20px;
            color: var(--text-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 10px;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .settings-nav-item:hover {
            background: rgba(47, 79, 57, 0.05);
            color: var(--primary-color);
        }

        .settings-nav-item.active {
            background: rgba(47, 79, 57, 0.1);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
            font-weight: 500;
        }

        .settings-nav-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .settings-content {
            background: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--border-color);
            min-height: 600px;
        }

        .settings-section {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .settings-section:last-child {
            border-bottom: none;
        }

        .settings-section-header {
            margin-bottom: 20px;
        }

        .settings-section-title {
            font-size: 18px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0 0 8px 0;
        }

        .settings-section-description {
            color: var(--text-secondary);
            font-size: 14px;
            margin: 0;
        }

        .settings-form {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .form-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .form-group-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .form-label {
            font-weight: 500;
            color: var(--text-color);
            font-size: 14px;
        }

        .form-label .required {
            color: var(--error-color);
            margin-left: 4px;
        }

        .form-input,
        .form-select,
        .form-textarea {
            padding: 8px 12px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.3s;
            background: white;
        }

        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: var(--primary-color);
            box-shadow: 0 0 0 2px rgba(47, 79, 57, 0.1);
        }

        .form-textarea {
            min-height: 100px;
            resize: vertical;
            font-family: inherit;
        }

        .form-switch {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .switch {
            position: relative;
            width: 44px;
            height: 24px;
            background: #ccc;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.3s;
        }

        .switch.active {
            background: var(--primary-color);
        }

        .switch::after {
            content: '';
            position: absolute;
            width: 20px;
            height: 20px;
            background: white;
            border-radius: 50%;
            top: 2px;
            left: 2px;
            transition: transform 0.3s;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .switch.active::after {
            transform: translateX(20px);
        }

        .form-help {
            font-size: 12px;
            color: var(--text-secondary);
            margin-top: 4px;
        }

        .form-actions {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
            padding-top: 20px;
            border-top: 1px solid var(--border-color);
        }

        /* System Status */
        .status-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .status-card {
            background: #f9f9f9;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            padding: 16px;
            text-align: center;
        }

        .status-icon {
            font-size: 24px;
            margin-bottom: 8px;
        }

        .status-value {
            font-size: 20px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 4px;
        }

        .status-label {
            font-size: 12px;
            color: var(--text-secondary);
        }

        .status-card.good .status-icon {
            color: var(--success-color);
        }

        .status-card.warning .status-icon {
            color: var(--warning-color);
        }

        .status-card.error .status-icon {
            color: var(--error-color);
        }

        /* Logs */
        .logs-container {
            background: #1e1e1e;
            border-radius: 6px;
            padding: 16px;
            font-family: 'SFMono-Regular', 'Consolas', 'Liberation Mono', 'Menlo', monospace;
            font-size: 12px;
            color: #fff;
            max-height: 400px;
            overflow-y: auto;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .log-level-info {
            color: #1890ff;
        }

        .log-level-warning {
            color: #faad14;
        }

        .log-level-error {
            color: #ff4d4f;
        }

        .log-level-success {
            color: #52c41a;
        }

        /* Alert */
        .alert {
            padding: 12px 16px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .alert-info {
            background: #e6f7ff;
            border: 1px solid #91d5ff;
            color: #0050b3;
        }

        .alert-success {
            background: #f6ffed;
            border: 1px solid #b7eb8f;
            color: #389e0d;
        }

        .alert-warning {
            background: #fffbe6;
            border: 1px solid #ffe58f;
            color: #d48806;
        }

        .alert-error {
            background: #fff2f0;
            border: 1px solid #ffccc7;
            color: #cf1322;
        }

        /* Loading */
        .loading {
            text-align: center;
            padding: 40px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 2px solid #f3f3f3;
            border-top: 2px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 16px;
                gap: 12px;
            }

            .main-nav {
                gap: 4px;
                flex-wrap: wrap;
                justify-content: flex-start;
            }

            .nav-link {
                padding: 6px 8px;
                font-size: 12px;
            }

            .app-content {
                padding: 16px;
            }

            .settings-container {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .settings-sidebar {
                position: static;
            }

            .settings-nav {
                display: flex;
                overflow-x: auto;
                padding: 0;
            }

            .settings-nav-item {
                white-space: nowrap;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .settings-nav-item.active {
                border-left: none;
                border-bottom-color: var(--primary-color);
            }

            .form-group-row {
                grid-template-columns: 1fr;
            }

            .status-grid {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 0 8px;
                gap: 8px;
                position: relative;
            }

            .main-nav {
                display: none;
            }

            .user-name {
                display: none;
            }

            .menu-toggle {
                display: block;
            }

            .user-menu {
                position: relative;
            }

            .form-actions {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <header class="app-header">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation menu">â˜°</button>
                <a href="/dashboard/" class="logo">SuperEditor</a>
                <nav class="main-nav">
                    <a href="/my-documents/" class="nav-link">æˆ‘çš„æ–‡æ¡£</a>
                    <a href="/my-images/" class="nav-link">æˆ‘çš„å›¾ç‰‡</a>
                    <a href="/my-files/" class="nav-link">æˆ‘çš„æ–‡ä»¶</a>
                    <a href="/system-settings/" class="nav-link active">ç³»ç»Ÿè®¾ç½®</a>
                    <a href="/user-settings/" class="nav-link">ç”¨æˆ·è®¾ç½®</a>
                </nav>
                <div class="user-menu">
                    <span class="user-name" id="userName">Loading...</span>
                    <button type="button" class="btn btn-secondary" id="logoutBtn">é€€å‡ºç™»å½•</button>
                </div>
            </div>
            <!-- Mobile menu -->
            <div class="mobile-menu" id="mobileMenu">
                <a href="/my-documents/" class="mobile-nav-link">æˆ‘çš„æ–‡æ¡£</a>
                <a href="/my-images/" class="mobile-nav-link">æˆ‘çš„å›¾ç‰‡</a>
                <a href="/my-files/" class="mobile-nav-link">æˆ‘çš„æ–‡ä»¶</a>
                <a href="/system-settings/" class="mobile-nav-link">ç³»ç»Ÿè®¾ç½®</a>
                <a href="/user-settings/" class="mobile-nav-link">ç”¨æˆ·è®¾ç½®</a>
                <button class="mobile-nav-link" id="mobileLogoutBtn" style="background: none; border: none; text-align: left; cursor: pointer;">é€€å‡ºç™»å½•</button>
            </div>
        </header>

        <div class="app-content">
            <div class="page-header">
                <h1 class="page-title">ç³»ç»Ÿè®¾ç½®</h1>
                <p class="page-subtitle">ç®¡ç† SuperEditor ç³»ç»Ÿé…ç½®å’Œè¿è¡ŒçŠ¶æ€</p>
            </div>

            <div class="settings-container">
                <!-- Sidebar Navigation -->
                <aside class="settings-sidebar">
                    <nav class="settings-nav">
                        <a href="#overview" class="settings-nav-item active" data-section="overview">
                            <span class="settings-nav-icon">ğŸ“Š</span>
                            <span>ç³»ç»Ÿæ¦‚è§ˆ</span>
                        </a>
                        <a href="#general" class="settings-nav-item" data-section="general">
                            <span class="settings-nav-icon">âš™ï¸</span>
                            <span>å¸¸è§„è®¾ç½®</span>
                        </a>
                        <a href="#storage" class="settings-nav-item" data-section="storage">
                            <span class="settings-nav-icon">ğŸ’¾</span>
                            <span>å­˜å‚¨é…ç½®</span>
                        </a>
                        <a href="#security" class="settings-nav-item" data-section="security">
                            <span class="settings-nav-icon">ğŸ”’</span>
                            <span>å®‰å…¨è®¾ç½®</span>
                        </a>
                        <a href="#backup" class="settings-nav-item" data-section="backup">
                            <span class="settings-nav-icon">ğŸ“¦</span>
                            <span>å¤‡ä»½ç®¡ç†</span>
                        </a>
                        <a href="#logs" class="settings-nav-item" data-section="logs">
                            <span class="settings-nav-icon">ğŸ“„</span>
                            <span>ç³»ç»Ÿæ—¥å¿—</span>
                        </a>
                    </nav>
                </aside>

                <!-- Main Content -->
                <main class="settings-content" id="settingsContent">
                    <!-- Content will be loaded dynamically -->
                </main>
            </div>
        </div>
    </div>

    <script>
        let currentSection = 'overview';

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize mobile menu
            initMobileMenu();

            // Load user information and check authentication
            loadUserInfo();

            // Initialize navigation
            initializeNavigation();

            // Load initial section
            loadSection('overview');

            // Event listeners
            document.getElementById('logoutBtn').addEventListener('click', async () => {
                await handleLogout();
            });
        });

        async function loadUserInfo() {
            try {
                const response = await fetch('/api/auth/me', {
                    credentials: 'include'
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('userName').textContent = data.name || data.email || 'User';
                } else {
                    if (response.status === 401) {
                        window.location.href = '/login/';
                        return;
                    }
                    document.getElementById('userName').textContent = 'User';
                    console.error('Failed to load user info:', data.error);
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                document.getElementById('userName').textContent = 'User';
                window.location.href = '/login/';
            }
        }

        function initializeNavigation() {
            const navItems = document.querySelectorAll('.settings-nav-item');

            navItems.forEach(item => {
                item.addEventListener('click', (e) => {
                    e.preventDefault();
                    const section = item.dataset.section;

                    // Update active state
                    navItems.forEach(nav => nav.classList.remove('active'));
                    item.classList.add('active');

                    // Load section content
                    loadSection(section);
                });
            });
        }

        async function loadSection(section) {
            currentSection = section;
            const content = document.getElementById('settingsContent');

            // Show loading
            content.innerHTML = `
                <div class="loading">
                    <div class="loading-spinner"></div>
                    <div>åŠ è½½ä¸­...</div>
                </div>
            `;

            try {
                // In a real application, you would fetch this from the server
                // For now, we'll generate the content client-side
                const sectionContent = generateSectionContent(section);
                content.innerHTML = sectionContent;

                // Initialize section-specific functionality
                initializeSection(section);
            } catch (error) {
                console.error('Error loading section:', error);
                content.innerHTML = `
                    <div class="loading">
                        <p>Error loading section: ${error.message}</p>
                    </div>
                `;
            }
        }

        function generateSectionContent(section) {
            const contents = {
                overview: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">ç³»ç»Ÿæ¦‚è§ˆ</h2>
                            <p class="settings-section-description">æŸ¥çœ‹ç³»ç»Ÿè¿è¡ŒçŠ¶æ€å’ŒåŸºæœ¬ä¿¡æ¯</p>
                        </div>

                        <div class="status-grid">
                            <div class="status-card good">
                                <div class="status-icon">âœ…</div>
                                <div class="status-value">æ­£å¸¸</div>
                                <div class="status-label">ç³»ç»ŸçŠ¶æ€</div>
                            </div>
                            <div class="status-card good">
                                <div class="status-icon">ğŸ‘¥</div>
                                <div class="status-value" id="userCount">-</div>
                                <div class="status-label">æ³¨å†Œç”¨æˆ·</div>
                            </div>
                            <div class="status-card good">
                                <div class="status-icon">ğŸ“„</div>
                                <div class="status-value" id="documentCount">-</div>
                                <div class="status-label">æ–‡æ¡£æ€»æ•°</div>
                            </div>
                            <div class="status-card good">
                                <div class="status-icon">ğŸ’¾</div>
                                <div class="status-value" id="storageUsed">-</div>
                                <div class="status-label">å­˜å‚¨ä½¿ç”¨</div>
                            </div>
                        </div>

                        <div class="form-group">
                            <h3>ç³»ç»Ÿä¿¡æ¯</h3>
                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 16px; margin-top: 16px;">
                                <div>
                                    <strong>ç‰ˆæœ¬:</strong> SuperEditor v1.0.0
                                </div>
                                <div>
                                    <strong>è¿è¡Œæ—¶é—´:</strong> <span id="uptime">-</span>
                                </div>
                                <div>
                                    <strong>ç¯å¢ƒ:</strong> Production
                                </div>
                                <div>
                                    <strong>æœ€åæ›´æ–°:</strong> ${new Date().toLocaleDateString('zh-CN')}
                                </div>
                            </div>
                        </div>
                    </div>
                `,

                general: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">å¸¸è§„è®¾ç½®</h2>
                            <p class="settings-section-description">é…ç½®ç³»ç»ŸåŸºæœ¬å‚æ•°</p>
                        </div>

                        <form class="settings-form" id="generalForm">
                            <div class="form-group">
                                <label class="form-label">ç³»ç»Ÿåç§° <span class="required">*</span></label>
                                <input type="text" class="form-input" value="SuperEditor" required>
                                <div class="form-help">æ˜¾ç¤ºåœ¨é¡µé¢æ ‡é¢˜å’Œå¯¼èˆªæ çš„ç³»ç»Ÿåç§°</div>
                            </div>

                            <div class="form-group-row">
                                <div class="form-group">
                                    <label class="form-label">é»˜è®¤è¯­è¨€</label>
                                    <select class="form-select">
                                        <option value="zh-CN" selected>ç®€ä½“ä¸­æ–‡</option>
                                        <option value="en-US">English</option>
                                        <option value="ja-JP">æ—¥æœ¬èª</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">æ—¶åŒº</label>
                                    <select class="form-select">
                                        <option value="Asia/Shanghai" selected>Asia/Shanghai</option>
                                        <option value="UTC">UTC</option>
                                        <option value="America/New_York">America/New_York</option>
                                        <option value="Europe/London">Europe/London</option>
                                    </select>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ç³»ç»Ÿæè¿°</label>
                                <textarea class="form-textarea" rows="3">ä¸€ä¸ªåŠŸèƒ½å¼ºå¤§çš„åœ¨çº¿ç¼–è¾‘å™¨å’Œæ–‡æ¡£ç®¡ç†ç³»ç»Ÿ</textarea>
                                <div class="form-help">æ˜¾ç¤ºåœ¨ç™»å½•é¡µé¢çš„ç³»ç»Ÿæè¿°</div>
                            </div>

                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">å…è®¸ç”¨æˆ·æ³¨å†Œ</label>
                                    <div class="switch active" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">æ˜¯å¦å¼€æ”¾æ–°ç”¨æˆ·æ³¨å†ŒåŠŸèƒ½</div>
                            </div>

                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">å¯ç”¨é‚®ä»¶é€šçŸ¥</label>
                                    <div class="switch active" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">å‘ç”¨æˆ·å‘é€é‡è¦äº‹ä»¶é‚®ä»¶é€šçŸ¥</div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn" onclick="resetForm('generalForm')">é‡ç½®</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </form>
                    </div>
                `,

                storage: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">å­˜å‚¨é…ç½®</h2>
                            <p class="settings-section-description">ç®¡ç†æ–‡ä»¶å­˜å‚¨å’Œç©ºé—´é™åˆ¶</p>
                        </div>

                        <form class="settings-form" id="storageForm">
                            <div class="form-group">
                                <label class="form-label">å­˜å‚¨åç«¯</label>
                                <select class="form-select">
                                    <option value="r2" selected>Cloudflare R2</option>
                                    <option value="s3">AWS S3</option>
                                    <option value="local">æœ¬åœ°å­˜å‚¨</option>
                                </select>
                                <div class="form-help">é€‰æ‹©æ–‡ä»¶å­˜å‚¨çš„åç«¯æœåŠ¡</div>
                            </div>

                            <div class="form-group-row">
                                <div class="form-group">
                                    <label class="form-label">å•ç”¨æˆ·å­˜å‚¨é™åˆ¶ (MB)</label>
                                    <input type="number" class="form-input" value="1024" min="0">
                                    <div class="form-help">0 è¡¨ç¤ºæ— é™åˆ¶</div>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">å•æ–‡ä»¶å¤§å°é™åˆ¶ (MB)</label>
                                    <input type="number" class="form-input" value="50" min="1">
                                    <div class="form-help">å•ä¸ªæ–‡ä»¶çš„æœ€å¤§å…è®¸å¤§å°</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">å…è®¸çš„æ–‡ä»¶ç±»å‹</label>
                                <textarea class="form-textarea" rows="4">jpg,jpeg,png,gif,pdf,doc,docx,txt,md,zip,rar</textarea>
                                <div class="form-help">ç”¨é€—å·åˆ†éš”æ–‡ä»¶æ‰©å±•åï¼Œç•™ç©ºè¡¨ç¤ºå…è®¸æ‰€æœ‰ç±»å‹</div>
                            </div>

                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">è‡ªåŠ¨å‹ç¼©å›¾ç‰‡</label>
                                    <div class="switch" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">è‡ªåŠ¨å‹ç¼©ä¸Šä¼ çš„å›¾ç‰‡ä»¥èŠ‚çœå­˜å‚¨ç©ºé—´</div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn" onclick="resetForm('storageForm')">é‡ç½®</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </form>
                    </div>
                `,

                security: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">å®‰å…¨è®¾ç½®</h2>
                            <p class="settings-section-description">é…ç½®ç³»ç»Ÿå®‰å…¨ç­–ç•¥</p>
                        </div>

                        <form class="settings-form" id="securityForm">
                            <div class="alert alert-info">
                                <span>â„¹ï¸</span>
                                <span>ä¿®æ”¹å®‰å…¨è®¾ç½®å¯èƒ½å½±å“ç”¨æˆ·ä½“éªŒï¼Œè¯·è°¨æ…æ“ä½œ</span>
                            </div>

                            <div class="form-group">
                                <label class="form-label">ä¼šè¯è¶…æ—¶æ—¶é—´ (åˆ†é’Ÿ)</label>
                                <input type="number" class="form-input" value="1440" min="10">
                                <div class="form-help">ç”¨æˆ·ä¸æ´»åŠ¨åè‡ªåŠ¨ç™»å‡ºçš„æ—¶é—´</div>
                            </div>

                            <div class="form-group-row">
                                <div class="form-group">
                                    <label class="form-label">å¯†ç æœ€å°é•¿åº¦</label>
                                    <input type="number" class="form-input" value="8" min="6" max="50">
                                </div>

                                <div class="form-group">
                                    <label class="form-label">ç™»å½•å¤±è´¥é”å®šæ¬¡æ•°</label>
                                    <input type="number" class="form-input" value="5" min="3" max="20">
                                    <div class="form-help">è¿ç»­ç™»å½•å¤±è´¥åé”å®šè´¦æˆ·çš„æ¬¡æ•°</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">å¯ç”¨åŒå› ç´ è®¤è¯</label>
                                    <div class="switch" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">ä¸ºç”¨æˆ·è´¦æˆ·æä¾›é¢å¤–çš„å®‰å…¨ä¿æŠ¤</div>
                            </div>

                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">å¼ºåˆ¶ HTTPS</label>
                                    <div class="switch active" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">è‡ªåŠ¨å°† HTTP è¯·æ±‚é‡å®šå‘åˆ° HTTPS</div>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn" onclick="resetForm('securityForm')">é‡ç½®</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </form>
                    </div>
                `,

                backup: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">å¤‡ä»½ç®¡ç†</h2>
                            <p class="settings-section-description">é…ç½®ç³»ç»Ÿè‡ªåŠ¨å¤‡ä»½å’Œæ¢å¤</p>
                        </div>

                        <form class="settings-form" id="backupForm">
                            <div class="form-group">
                                <div class="form-switch">
                                    <label class="form-label">å¯ç”¨è‡ªåŠ¨å¤‡ä»½</label>
                                    <div class="switch active" onclick="toggleSwitch(this)"></div>
                                </div>
                                <div class="form-help">å®šæœŸè‡ªåŠ¨å¤‡ä»½ç³»ç»Ÿæ•°æ®å’Œç”¨æˆ·æ–‡ä»¶</div>
                            </div>

                            <div class="form-group-row">
                                <div class="form-group">
                                    <label class="form-label">å¤‡ä»½é¢‘ç‡</label>
                                    <select class="form-select">
                                        <option value="daily" selected>æ¯æ—¥</option>
                                        <option value="weekly">æ¯å‘¨</option>
                                        <option value="monthly">æ¯æœˆ</option>
                                    </select>
                                </div>

                                <div class="form-group">
                                    <label class="form-label">ä¿ç•™å¤‡ä»½æ•°é‡</label>
                                    <input type="number" class="form-input" value="30" min="1" max="365">
                                    <div class="form-help">ä¿ç•™çš„å¤‡ä»½æ–‡ä»¶æ•°é‡ï¼Œè¶…å‡ºæ•°é‡å°†åˆ é™¤æ—§å¤‡ä»½</div>
                                </div>
                            </div>

                            <div class="form-group">
                                <label class="form-label">å¤‡ä»½å­˜å‚¨ä½ç½®</label>
                                <select class="form-select">
                                    <option value="local" selected>æœ¬åœ°å­˜å‚¨</option>
                                    <option value="cloud">äº‘ç«¯å­˜å‚¨</option>
                                    <option value="both">æœ¬åœ° + äº‘ç«¯</option>
                                </select>
                            </div>

                            <div class="form-actions">
                                <button type="button" class="btn btn-success" onclick="createBackup()">
                                    <span>ğŸ“¦</span>
                                    <span>ç«‹å³å¤‡ä»½</span>
                                </button>
                                <button type="button" class="btn" onclick="resetForm('backupForm')">é‡ç½®</button>
                                <button type="submit" class="btn btn-primary">ä¿å­˜è®¾ç½®</button>
                            </div>
                        </form>

                        <div style="margin-top: 32px;">
                            <h3>æœ€è¿‘å¤‡ä»½</h3>
                            <div id="backupList" style="margin-top: 16px;">
                                <div class="loading">
                                    <div class="loading-spinner"></div>
                                    <div>åŠ è½½å¤‡ä»½åˆ—è¡¨...</div>
                                </div>
                            </div>
                        </div>
                    </div>
                `,

                logs: `
                    <div class="settings-section">
                        <div class="settings-section-header">
                            <h2 class="settings-section-title">ç³»ç»Ÿæ—¥å¿—</h2>
                            <p class="settings-section-description">æŸ¥çœ‹å’Œåˆ†æç³»ç»Ÿè¿è¡Œæ—¥å¿—</p>
                        </div>

                        <div style="margin-bottom: 20px; display: flex; gap: 12px; align-items: center; flex-wrap: wrap;">
                            <select class="form-select" style="width: auto;" id="logLevel">
                                <option value="all" selected>æ‰€æœ‰çº§åˆ«</option>
                                <option value="error">é”™è¯¯</option>
                                <option value="warning">è­¦å‘Š</option>
                                <option value="info">ä¿¡æ¯</option>
                                <option value="success">æˆåŠŸ</option>
                            </select>

                            <select class="form-select" style="width: auto;" id="logTimeRange">
                                <option value="1h">æœ€è¿‘ 1 å°æ—¶</option>
                                <option value="6h">æœ€è¿‘ 6 å°æ—¶</option>
                                <option value="24h" selected>æœ€è¿‘ 24 å°æ—¶</option>
                                <option value="7d">æœ€è¿‘ 7 å¤©</option>
                                <option value="30d">æœ€è¿‘ 30 å¤©</option>
                            </select>

                            <button type="button" class="btn" onclick="refreshLogs()">
                                <span>ğŸ”„</span>
                                <span>åˆ·æ–°</span>
                            </button>

                            <button type="button" class="btn btn-primary" onclick="downloadLogs()">
                                <span>ğŸ“¥</span>
                                <span>ä¸‹è½½æ—¥å¿—</span>
                            </button>
                        </div>

                        <div class="logs-container" id="logContainer">
                            <div>æ­£åœ¨åŠ è½½æ—¥å¿—...</div>
                        </div>
                    </div>
                `
            };

            return contents[section] || '<div class="loading">Section not found</div>';
        }

        function initializeSection(section) {
            switch (section) {
                case 'overview':
                    loadSystemOverview();
                    break;
                case 'backup':
                    loadBackupList();
                    break;
                case 'logs':
                    loadLogs();
                    break;
            }

            // Initialize form handlers
            const form = document.querySelector(`#${section}Form`);
            if (form) {
                form.addEventListener('submit', (e) => {
                    e.preventDefault();
                    saveSettings(section);
                });
            }
        }

        async function loadSystemOverview() {
            try {
                // In a real application, fetch this data from the server
                // For demo purposes, we'll use mock data
                const mockData = {
                    userCount: Math.floor(Math.random() * 1000) + 100,
                    documentCount: Math.floor(Math.random() * 5000) + 500,
                    storageUsed: (Math.random() * 10 + 1).toFixed(1) + ' GB',
                    uptime: Math.floor(Math.random() * 30) + 1 + ' å¤©'
                };

                document.getElementById('userCount').textContent = mockData.userCount;
                document.getElementById('documentCount').textContent = mockData.documentCount;
                document.getElementById('storageUsed').textContent = mockData.storageUsed;
                document.getElementById('uptime').textContent = mockData.uptime;
            } catch (error) {
                console.error('Error loading system overview:', error);
            }
        }

        async function loadBackupList() {
            const container = document.getElementById('backupList');

            try {
                // Mock backup data
                const backups = [
                    { date: '2024-01-15 02:00:00', size: '156 MB', type: 'è‡ªåŠ¨', status: 'æˆåŠŸ' },
                    { date: '2024-01-14 02:00:00', size: '152 MB', type: 'è‡ªåŠ¨', status: 'æˆåŠŸ' },
                    { date: '2024-01-13 02:00:00', size: '148 MB', type: 'è‡ªåŠ¨', status: 'æˆåŠŸ' },
                    { date: '2024-01-12 02:00:00', size: '145 MB', type: 'è‡ªåŠ¨', status: 'æˆåŠŸ' },
                    { date: '2024-01-11 02:00:00', size: '142 MB', type: 'è‡ªåŠ¨', status: 'æˆåŠŸ' }
                ];

                let html = '<table style="width: 100%; border-collapse: collapse;">';
                html += `
                    <thead>
                        <tr style="background: #f9f9f9; border-bottom: 1px solid var(--border-color);">
                            <th style="padding: 12px; text-align: left;">å¤‡ä»½æ—¶é—´</th>
                            <th style="padding: 12px; text-align: left;">å¤§å°</th>
                            <th style="padding: 12px; text-align: left;">ç±»å‹</th>
                            <th style="padding: 12px; text-align: left;">çŠ¶æ€</th>
                            <th style="padding: 12px; text-align: left;">æ“ä½œ</th>
                        </tr>
                    </thead>
                    <tbody>
                `;

                backups.forEach(backup => {
                    html += `
                        <tr style="border-bottom: 1px solid var(--border-color);">
                            <td style="padding: 12px;">${backup.date}</td>
                            <td style="padding: 12px;">${backup.size}</td>
                            <td style="padding: 12px;">${backup.type}</td>
                            <td style="padding: 12px;">
                                <span style="color: var(--success-color);">âœ… ${backup.status}</span>
                            </td>
                            <td style="padding: 12px;">
                                <button type="button" class="btn btn-sm" onclick="restoreBackup('${backup.date}')">
                                    <span>ğŸ”„</span>
                                    <span>æ¢å¤</span>
                                </button>
                                <button type="button" class="btn btn-sm" onclick="downloadBackup('${backup.date}')">
                                    <span>ğŸ“¥</span>
                                    <span>ä¸‹è½½</span>
                                </button>
                                <button type="button" class="btn btn-danger btn-sm" onclick="deleteBackup('${backup.date}')">
                                    <span>ğŸ—‘ï¸</span>
                                    <span>åˆ é™¤</span>
                                </button>
                            </td>
                        </tr>
                    `;
                });

                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading backup list:', error);
                container.innerHTML = '<p style="color: var(--text-secondary);">æ— æ³•åŠ è½½å¤‡ä»½åˆ—è¡¨</p>';
            }
        }

        function loadLogs() {
            const container = document.getElementById('logContainer');

            // Mock log data
            const mockLogs = [
                { timestamp: '2024-01-15 10:30:15', level: 'info', message: 'System started successfully' },
                { timestamp: '2024-01-15 10:25:32', level: 'success', message: 'Database backup completed' },
                { timestamp: '2024-01-15 10:20:18', level: 'warning', message: 'High memory usage detected: 85%' },
                { timestamp: '2024-01-15 10:15:44', level: 'info', message: 'User authentication: user@example.com' },
                { timestamp: '2024-01-15 10:10:22', level: 'error', message: 'Failed to connect to external service: timeout' },
                { timestamp: '2024-01-15 10:05:10', level: 'info', message: 'Scheduled maintenance task completed' }
            ];

            let logHtml = '';
            mockLogs.forEach(log => {
                const levelClass = `log-level-${log.level}`;
                const levelEmoji = {
                    'info': 'â„¹ï¸',
                    'success': 'âœ…',
                    'warning': 'âš ï¸',
                    'error': 'âŒ'
                }[log.level];

                logHtml += `<div><span class="${levelClass}">[${log.timestamp}] ${levelEmoji} ${log.level.toUpperCase()}: ${log.message}</span></div>`;
            });

            container.innerHTML = logHtml || '<div style="color: var(--text-secondary);">æš‚æ— æ—¥å¿—è®°å½•</div>';
        }

        function toggleSwitch(element) {
            element.classList.toggle('active');
        }

        function resetForm(formId) {
            const form = document.getElementById(formId);
            if (form) {
                form.reset();
                // Reset switches to initial state
                form.querySelectorAll('.switch').forEach(switchElement => {
                    // Set to default state based on the data-default attribute or default behavior
                    if (switchElement.hasAttribute('data-default')) {
                        if (switchElement.getAttribute('data-default') === 'true') {
                            switchElement.classList.add('active');
                        } else {
                            switchElement.classList.remove('active');
                        }
                    }
                });
            }
        }

        async function saveSettings(section) {
            try {
                // In a real application, this would send data to the server
                console.log(`Saving settings for section: ${section}`);

                // Show success message
                showNotification('è®¾ç½®å·²ä¿å­˜', 'success');
            } catch (error) {
                console.error('Error saving settings:', error);
                showNotification('ä¿å­˜è®¾ç½®å¤±è´¥', 'error');
            }
        }

        async function createBackup() {
            try {
                showNotification('æ­£åœ¨åˆ›å»ºå¤‡ä»½...', 'info');

                // Simulate backup creation
                setTimeout(() => {
                    showNotification('å¤‡ä»½åˆ›å»ºæˆåŠŸ', 'success');
                    loadBackupList();
                }, 2000);
            } catch (error) {
                console.error('Error creating backup:', error);
                showNotification('åˆ›å»ºå¤‡ä»½å¤±è´¥', 'error');
            }
        }

        async function refreshLogs() {
            const container = document.getElementById('logContainer');
            container.innerHTML = '<div>æ­£åœ¨åˆ·æ–°æ—¥å¿—...</div>';

            setTimeout(() => {
                loadLogs();
            }, 1000);
        }

        function showNotification(message, type = 'info') {
            // Create a simple notification (in a real app, you'd use a proper notification system)
            const alertClass = `alert-${type}`;
            const notification = document.createElement('div');
            notification.className = `alert ${alertClass}`;
            notification.style.position = 'fixed';
            notification.style.top = '20px';
            notification.style.right = '20px';
            notification.style.zIndex = '10000';
            notification.style.minWidth = '300px';
            notification.innerHTML = `
                <span>${type === 'success' ? 'âœ…' : type === 'error' ? 'âŒ' : 'â„¹ï¸'}</span>
                <span>${message}</span>
            `;

            document.body.appendChild(notification);

            setTimeout(() => {
                notification.remove();
            }, 3000);
        }

        // Mobile menu functionality
        function initMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

            // Toggle mobile menu
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('active');
            });

            // Close menu when clicking links
            const mobileLinks = mobileMenu.querySelectorAll('.mobile-nav-link');
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            });

            // Mobile logout functionality
            mobileLogoutBtn.addEventListener('click', async () => {
                await handleLogout();
            });

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (!menuToggle.contains(event.target) && !mobileMenu.contains(event.target)) {
                    mobileMenu.classList.remove('active');
                }
            });
        }

        // Logout functionality
        async function handleLogout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    window.location.href = '/login/';
                } else {
                    alert('Logout failed');
                }
            } catch (error) {
                console.error('Logout error:', error);
                alert('Network error during logout');
            }
        }

        // Placeholder functions for backup actions
        function restoreBackup(date) {
            if (confirm(`ç¡®å®šè¦æ¢å¤ ${date} çš„å¤‡ä»½å—ï¼Ÿè¿™å°†è¦†ç›–å½“å‰æ•°æ®ã€‚`)) {
                showNotification('æ­£åœ¨æ¢å¤å¤‡ä»½...', 'info');
            }
        }

        function downloadBackup(date) {
            showNotification(`æ­£åœ¨ä¸‹è½½ ${date} çš„å¤‡ä»½...`, 'info');
        }

        function deleteBackup(date) {
            if (confirm(`ç¡®å®šè¦åˆ é™¤ ${date} çš„å¤‡ä»½å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ¢å¤ã€‚`)) {
                showNotification('å¤‡ä»½å·²åˆ é™¤', 'success');
                loadBackupList();
            }
        }

        function downloadLogs() {
            showNotification('æ­£åœ¨ä¸‹è½½æ—¥å¿—æ–‡ä»¶...', 'info');
        }
    </script>
</body>
</html>