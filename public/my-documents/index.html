<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ÊàëÁöÑÊñáÊ°£ - SuperEditor</title>
    <!-- Ant Design CSS -->
    <link rel="stylesheet" href="https://unpkg.com/antd@5.21.6/dist/reset.css">
    <!-- Ant Design Icons -->
    <link rel="stylesheet" href="https://unpkg.com/@ant-design/icons@5.4.0/lib/index.css">
    <!-- Highlight.js for code syntax highlighting -->
    <link rel="stylesheet" href="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/styles/github.min.css">
    <!-- KaTeX for math rendering -->
    <link rel="stylesheet" href="https://unpkg.com/katex@0.16.9/dist/katex.min.css">
    <style>
        :root {
            --primary-color: #2F4F39;
            --primary-hover: #233A2B;
            --primary-light: #7BA89E;
            --background-light: #E6E1D6;
            --text-color: #333;
            --text-secondary: #666;
            --border-color: #d9d9d9;
            --shadow: 0 3px 6px -4px rgba(0,0,0,.12), 0 6px 16px 0 rgba(0,0,0,.08), 0 9px 28px 8px rgba(0,0,0,.05);
            --card-shadow: 0 1px 2px 0 rgba(0, 0, 0, 0.03), 0 1px 6px -1px rgba(0, 0, 0, 0.02), 0 2px 4px 0 rgba(0, 0, 0, 0.02);
        }

        * {
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
            color: var(--text-color);
        }

        .app-layout {
            min-height: 100vh;
            display: flex;
            flex-direction: column;
        }

        .app-header {
            background: white;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 24px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 64px;
            gap: 24px;
        }

        .logo {
            font-size: 20px;
            font-weight: 600;
            color: var(--primary-color);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .logo::before {
            content: 'üìù';
            font-size: 24px;
        }

        .main-nav {
            display: flex;
            align-items: center;
            gap: 0;
            flex: 1;
            justify-content: center;
        }

        .nav-link {
            padding: 8px 16px;
            color: var(--text-color);
            text-decoration: none;
            font-size: 14px;
            font-weight: 500;
            border-radius: 6px;
            transition: all 0.3s;
            position: relative;
        }

        .nav-link:hover {
            color: var(--primary-color);
            background-color: rgba(47, 79, 57, 0.1);
        }

        .nav-link.active {
            color: var(--primary-color);
            background-color: rgba(47, 79, 57, 0.15);
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-name {
            color: var(--text-secondary);
            font-size: 14px;
        }

        .app-content {
            flex: 1;
            padding: 24px;
            max-width: 1200px;
            margin: 0 auto;
            width: 100%;
        }

        /* Breadcrumb navigation */
        .breadcrumb {
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 8px;
            font-size: 14px;
        }

        .breadcrumb-item {
            color: var(--text-secondary);
            text-decoration: none;
            transition: color 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .breadcrumb-item:hover {
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            color: var(--text-color);
            font-weight: 500;
        }

        .breadcrumb-separator {
            color: var(--text-secondary);
            user-select: none;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
        }

        .page-header {
            margin-bottom: 32px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
        }

        .page-title {
            font-size: 24px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        .page-subtitle {
            color: var(--text-secondary);
            margin: 8px 0 0 0;
            font-size: 14px;
        }

        .btn {
            padding: 6px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 500;
            transition: all 0.3s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
            background: white;
            color: var(--text-color);
            text-decoration: none;
        }

        .btn:hover {
            border-color: var(--primary-light);
            color: var(--primary-light);
        }

        .btn-primary {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-hover);
            border-color: var(--primary-hover);
        }

        .btn-danger {
            background-color: #ff4d4f;
            border-color: #ff4d4f;
            color: white;
        }

        .btn-danger:hover {
            background-color: #d9363e;
            border-color: #d9363e;
        }

        .btn-success {
            background-color: #52c41a;
            border-color: #52c41a;
            color: white;
        }

        .btn-success:hover {
            background-color: #389e0d;
            border-color: #389e0d;
        }

        .btn-lg {
            padding: 8px 20px;
            font-size: 16px;
            height: 40px;
        }

        .btn-sm {
            padding: 6px 10px;
            font-size: 12px;
            height: auto;
            min-height: 32px;
            white-space: nowrap;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 4px;
            line-height: 1.2;
            text-align: center;
        }

        .btn-sm span {
            display: inline-block;
            vertical-align: middle;
        }

        .btn-secondary {
            background-color: white;
            border-color: var(--border-color);
            color: var(--text-color);
        }

        .btn-secondary:hover {
            background-color: #f5f5f5;
            border-color: var(--primary-light);
        }

        /* Hamburger menu styles */
        .menu-toggle {
            display: none;
            background: none;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: var(--text-color);
            padding: 8px;
            border-radius: 4px;
            transition: background-color 0.3s;
        }

        .menu-toggle:hover {
            background-color: rgba(47, 79, 57, 0.1);
        }

        /* Mobile menu styles */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 64px;
            left: 0;
            right: 0;
            background: white;
            border-bottom: 1px solid var(--border-color);
            box-shadow: var(--shadow);
            z-index: 200;
            max-height: calc(100vh - 64px);
            overflow-y: auto;
        }

        .mobile-menu.active {
            display: block;
            animation: slideDown 0.3s ease-out;
        }

        .mobile-nav-link {
            display: block;
            padding: 12px 24px;
            color: var(--text-color);
            text-decoration: none;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.3s;
            font-size: 14px;
            font-weight: 500;
        }

        .mobile-nav-link:hover {
            background-color: rgba(47, 79, 57, 0.1);
            color: var(--primary-color);
        }

        .mobile-nav-link:last-child {
            border-bottom: none;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .documents-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(320px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }

        .document-card, .folder-card {
            background: white;
            border-radius: 8px;
            box-shadow: var(--card-shadow);
            transition: all 0.3s;
            overflow: hidden;
            border: 1px solid var(--border-color);
            min-height: 200px;
            display: flex;
            flex-direction: column;
        }

        .document-card:hover, .folder-card:hover {
            box-shadow: var(--shadow);
            transform: translateY(-2px);
        }

        .folder-card {
            background: white;
            border-left: 4px solid var(--primary-color);
        }

        .folder-card-body, .document-card-body {
            padding: 20px;
            position: relative;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .folder-card-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .folder-icon {
            font-size: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 32px;
        }

        .folder-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            flex: 1;
        }

        .folder-meta {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .document-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            margin-bottom: 8px;
            line-height: 1.4;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .document-meta {
            color: var(--text-secondary);
            font-size: 12px;
            margin-bottom: 16px;
        }

        .document-meta::before {
            content: 'üìÖ';
            margin-right: 4px;
        }

        .document-actions {
            margin-top: auto;
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
            align-items: center;
        }

        .document-actions .btn-sm {
            flex: 0 0 auto;
            min-width: -webkit-fill-available;
            min-width: fit-content;
        }

        .empty-state {
            text-align: center;
            padding: 60px 20px;
            color: var(--text-secondary);
        }

        .empty-state-icon {
            font-size: 48px;
            margin-bottom: 16px;
            opacity: 0.5;
        }

        .empty-state-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 8px;
            color: var(--text-color);
        }

        .empty-state-description {
            font-size: 14px;
            margin-bottom: 24px;
        }

        /* Modal styles */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.45);
            animation: fadeIn 0.3s;
        }

        .modal.show {
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: 8px;
            width: 90%;
            max-width: 800px;
            max-height: 80vh;
            overflow: hidden;
            box-shadow: var(--shadow);
            animation: slideIn 0.3s;
            display: flex;
            flex-direction: column;
        }

        .modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 16px;
            font-weight: 600;
            margin: 0;
            color: var(--text-color);
        }

        .modal-header-actions {
            display: flex;
            gap: 8px;
            align-items: center;
        }

        .modal-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: var(--text-secondary);
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.3s;
        }

        .modal-close:hover {
            background-color: #f5f5f5;
            color: var(--text-color);
        }

        .modal-body {
            padding: 24px;
            overflow-y: auto;
            flex: 1;
        }

        .document-viewer h1 {
            border-bottom: 1px solid var(--border-color);
            padding-bottom: 12px;
            margin-bottom: 16px;
        }

        .document-viewer-content {
            line-height: 1.6;
            color: var(--text-color);
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            max-width: 100%;
        }

        .document-viewer-content img {
            max-width: 100%;
            height: auto;
            border-radius: 6px;
            margin: 12px 0;
        }

        /* Enhanced markdown preview styles */
        .document-viewer-content h1 {
            font-size: 2em;
            font-weight: 600;
            margin: 1.5em 0 0.5em 0;
            padding-bottom: 0.3em;
            border-bottom: 2px solid var(--primary-color);
            color: var(--text-color);
        }

        .document-viewer-content h2 {
            font-size: 1.5em;
            font-weight: 600;
            margin: 1.2em 0 0.4em 0;
            padding-bottom: 0.2em;
            border-bottom: 1px solid var(--primary-light);
            color: var(--text-color);
        }

        .document-viewer-content h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin: 1em 0 0.3em 0;
            color: var(--text-color);
        }

        .document-viewer-content h4, .document-viewer-content h5, .document-viewer-content h6 {
            font-weight: 600;
            margin: 0.8em 0 0.2em 0;
            color: var(--text-color);
        }

        .document-viewer-content p {
            margin: 0.8em 0;
            line-height: 1.6;
            color: var(--text-color);
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .document-viewer-content ul, .document-viewer-content ol {
            margin: 0.8em 0;
            padding-left: 2em;
        }

        .document-viewer-content li {
            margin: 0.2em 0;
            line-height: 1.5;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .document-viewer-content blockquote {
            margin: 1.5em 0;
            padding: 1em 1.5em;
            border-left: 5px solid var(--primary-color);
            background: linear-gradient(to right, rgba(47, 79, 57, 0.05), transparent);
            color: var(--text-secondary);
            font-style: italic;
            border-radius: 0 8px 8px 0;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
        }

        .document-viewer-content code {
            padding: 0.2em 0.4em;
            margin: 0;
            font-size: 85%;
            background-color: rgba(47, 79, 57, 0.1);
            border-radius: 3px;
            font-family: 'SFMono-Regular', 'Consolas', 'Liberation Mono', 'Menlo', monospace;
            color: var(--primary-color);
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-all;
        }

        .document-viewer-content pre {
            padding: 16px;
            overflow: auto;
            font-size: 85%;
            line-height: 1.45;
            background-color: #f6f8fa;
            border-radius: 6px;
            margin: 1em 0;
            border: 1px solid var(--border-color);
        }

        .document-viewer-content pre code {
            padding: 0;
            background: none;
            color: var(--text-color);
        }

        .document-viewer-content table {
            border-spacing: 0;
            border-collapse: separate;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            margin: 1em 0;
            width: 100%;
        }

        .document-viewer-content table th, .document-viewer-content table td {
            padding: 12px 16px;
            border: none;
            border-right: 1px solid var(--border-color);
            text-align: left;
            word-wrap: break-word;
            overflow-wrap: break-word;
            word-break: break-word;
            max-width: 200px;
        }

        .document-viewer-content table th:last-child,
        .document-viewer-content table td:last-child {
            border-right: none;
        }

        .document-viewer-content table th {
            background: linear-gradient(135deg, var(--primary-color) 0%, var(--primary-light) 100%);
            color: white;
            font-weight: 600;
        }

        .document-viewer-content table tr:nth-child(even) {
            background-color: #fafafa;
        }

        .document-viewer-content table tr:hover {
            background-color: #f0f8ff;
        }

        .document-viewer-content hr {
            height: 2px;
            background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
            border: none;
            margin: 3em 0;
            position: relative;
        }

        .document-viewer-content a {
            color: var(--primary-color);
            text-decoration: none;
            font-weight: 500;
        }

        .document-viewer-content a:hover {
            color: var(--primary-light);
            text-decoration: underline;
        }

        .document-viewer-content strong {
            font-weight: 600;
            color: var(--text-color);
        }

        .document-viewer-content em {
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Code block wrapper for copy functionality */
        .code-block-wrapper {
            position: relative;
            margin: 1.5em 0;
        }

        .copy-button {
            position: absolute;
            top: 8px;
            right: 8px;
            background: var(--primary-color);
            color: white;
            border: none;
            border-radius: 4px;
            padding: 4px 8px;
            font-size: 12px;
            cursor: pointer;
            transition: all 0.3s;
        }

        .copy-button:hover {
            background: var(--primary-hover);
        }

        .copy-button.copied {
            background: #52c41a;
        }

        /* Math styling */
        .katex-display {
            margin: 1em 0;
            text-align: center;
        }

        .katex {
            font-size: 1em;
        }

        /* Pagination styles */
        .pagination-container {
            margin-top: 32px;
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .pagination-info {
            color: var(--text-secondary);
            font-size: 14px;
            margin-right: auto;
            padding: 8px 0;
        }

        .pagination-controls {
            display: flex;
            align-items: center;
            gap: 4px;
        }

        .pagination-btn {
            min-width: 32px;
            height: 32px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            background: white;
            color: var(--text-color);
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
        }

        .pagination-btn:hover:not(:disabled) {
            border-color: var(--primary-color);
            color: var(--primary-color);
        }

        .pagination-btn:disabled {
            background-color: #f5f5f5;
            color: var(--text-secondary);
            cursor: not-allowed;
            opacity: 0.5;
        }

        .pagination-btn.active {
            background-color: var(--primary-color);
            border-color: var(--primary-color);
            color: white;
        }

        .pagination-ellipsis {
            padding: 0 8px;
            color: var(--text-secondary);
            font-size: 14px;
        }

        .page-jump {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-left: 16px;
        }

        .page-jump input {
            width: 50px;
            height: 32px;
            padding: 0 8px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 14px;
            text-align: center;
        }

        .page-jump button {
            height: 32px;
            padding: 0 12px;
            border: 1px solid var(--primary-color);
            background: var(--primary-color);
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s;
        }

        .page-jump button:hover {
            background: var(--primary-hover);
            border-color: var(--primary-hover);
        }

        /* Folder styles */


        .-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-color);
            margin: 0;
        }

        .-content {
            flex: 1;
            overflow-y: auto;
            padding: 8px 0;
        }

        . {
            list-style: none;
            margin: 0;
            padding: 0;
        }

        .-item {
            position: relative;
        }

        .-node {
            display: flex;
            align-items: center;
            padding: 8px 20px;
            cursor: pointer;
            transition: all 0.2s;
            border-left: 3px solid transparent;
            -webkit-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        .-node:hover {
            background-color: rgba(47, 79, 57, 0.05);
            border-left-color: var(--primary-light);
        }

        .-node.active {
            background-color: rgba(47, 79, 57, 0.1);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
            font-weight: 500;
        }

        .-icon {
            margin-right: 8px;
            font-size: 16px;
            transition: transform 0.2s;
        }

        .-node.expanded .-icon {
            transform: rotate(90deg);
        }

        .-label {
            flex: 1;
            font-size: 14px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .-count {
            font-size: 12px;
            color: var(--text-secondary);
            background-color: rgba(47, 79, 57, 0.1);
            padding: 2px 6px;
            border-radius: 10px;
            margin-left: 8px;
        }

        .-children {
            list-style: none;
            margin: 0;
            padding: 0;
            display: none;
        }

        .-node.expanded + .-children {
            display: block;
        }

        .-children .-node {
            padding-left: 44px;
            font-size: 13px;
        }

        .create-folder-btn {
            width: 100%;
            padding: 8px 20px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            color: var(--primary-color);
            transition: all 0.2s;
            border-top: 1px solid var(--border-color);
        }

        .create-folder-btn:hover {
            background-color: rgba(47, 79, 57, 0.05);
        }

        .main-content {
            flex: 1;
            min-width: 0;
        }

        /* Folder management dropdown */
        .folder-actions {
            position: relative;
            display: inline-block;
        }

        .folder-actions-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            box-shadow: var(--shadow);
            z-index: 100;
            min-width: 150px;
            display: none;
        }

        .folder-actions-dropdown.show {
            display: block;
        }

        .folder-actions-item {
            display: block;
            width: 100%;
            padding: 8px 12px;
            border: none;
            background: none;
            text-align: left;
            cursor: pointer;
            font-size: 14px;
            color: var(--text-color);
            transition: all 0.2s;
        }

        .folder-actions-item:hover {
            background-color: rgba(47, 79, 57, 0.05);
            color: var(--primary-color);
        }

        .folder-actions-item.danger {
            color: #ff4d4f;
        }

        .folder-actions-item.danger:hover {
            background-color: rgba(255, 77, 79, 0.05);
        }

        /* Document folder badge */
        .document-folder-badge {
            position: absolute;
            top: 12px;
            right: 12px;
            background-color: var(--primary-color);
            color: white;
            font-size: 11px;
            padding: 2px 6px;
            border-radius: 10px;
            max-width: 120px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        /* Enhanced Move Document Modal Styles */

        /* Search Container */
        .folder-search-container {
            margin-bottom: 16px;
            position: relative;
        }

        .search-input-wrapper {
            position: relative;
            display: flex;
            align-items: center;
        }

        .search-icon {
            position: absolute;
            left: 12px;
            width: 16px;
            height: 16px;
            color: var(--text-secondary);
            pointer-events: none;
            z-index: 1;
        }

        .folder-search-input {
            width: 100%;
            padding: 10px 12px 10px 40px;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            font-size: 14px;
            background: white;
            transition: all 0.2s ease;
            outline: none;
        }

        .folder-search-input:focus {
            border-color: var(--primary-color);
            box-shadow: 0 0 0 3px rgba(47, 79, 57, 0.1);
        }

        .search-clear-btn {
            position: absolute;
            right: 8px;
            width: 24px;
            height: 24px;
            border: none;
            background: var(--text-secondary);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            opacity: 0.6;
            transition: opacity 0.2s ease;
        }

        .search-clear-btn:hover {
            opacity: 1;
        }

        .search-clear-btn svg {
            width: 12px;
            height: 12px;
            stroke: white;
            stroke-width: 2;
        }

        /* Breadcrumb Navigation */
        .folder-breadcrumb {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 16px;
            padding: 8px 12px;
            background: rgba(47, 79, 57, 0.05);
            border-radius: 6px;
            font-size: 13px;
            color: var(--text-secondary);
            flex-wrap: wrap;
        }

        .breadcrumb-item {
            display: flex;
            align-items: center;
            gap: 6px;
            padding: 4px 8px;
            border-radius: 4px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .breadcrumb-item:hover:not(.active) {
            background: rgba(47, 79, 57, 0.1);
            color: var(--primary-color);
        }

        .breadcrumb-item.active {
            background: var(--primary-color);
            color: white;
            font-weight: 500;
        }

        .breadcrumb-icon {
            width: 14px;
            height: 14px;
        }

        /* Folder List Container */
        .folder-list-container {
            margin-bottom: 16px;
        }

        .folder-list {
            max-height: 400px;
            overflow-y: auto;
            border: 1px solid var(--border-color);
            border-radius: 8px;
            background: white;
            position: relative;
        }

        .folder-list::-webkit-scrollbar {
            width: 6px;
        }

        .folder-list::-webkit-scrollbar-track {
            background: var(--background-light);
            border-radius: 3px;
        }

        .folder-list::-webkit-scrollbar-thumb {
            background: var(--text-secondary);
            border-radius: 3px;
            opacity: 0.5;
        }

        .folder-list::-webkit-scrollbar-thumb:hover {
            background: var(--primary-color);
            opacity: 0.7;
        }

        /* Enhanced Folder Option */
        .folder-option {
            display: flex;
            align-items: center;
            padding: 12px 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            border-left: 3px solid transparent;
            border-bottom: 1px solid #f5f5f5;
            position: relative;
            gap: 12px;
        }

        .folder-option:last-child {
            border-bottom: none;
        }

        .folder-option:hover {
            background: rgba(47, 79, 57, 0.04);
            border-left-color: var(--primary-light);
        }

        .folder-option.selected {
            background: rgba(47, 79, 57, 0.08);
            border-left-color: var(--primary-color);
            color: var(--primary-color);
        }

        .folder-option.selected::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 3px;
            background: var(--primary-color);
        }

        .folder-option.keyboard-focus {
            outline: 2px solid var(--primary-color);
            outline-offset: -2px;
        }

        /* Folder Icons */
        .folder-option .folder-icon {
            width: 20px;
            height: 20px;
            flex-shrink: 0;
            color: var(--primary-light);
            transition: color 0.2s ease;
        }

        .folder-option.selected .folder-icon {
            color: var(--primary-color);
        }

        .folder-option.child .folder-icon {
            color: var(--primary-light);
            opacity: 0.8;
        }

        /* Folder Content */
        .folder-content {
            flex: 1;
            min-width: 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .folder-name {
            font-weight: 500;
            color: var(--text-color);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            flex: 1;
        }

        .folder-count {
            font-size: 12px;
            color: var(--text-secondary);
            background: rgba(47, 79, 57, 0.08);
            padding: 2px 8px;
            border-radius: 12px;
            font-weight: 500;
            white-space: nowrap;
        }

        .folder-option.selected .folder-count {
            background: rgba(47, 79, 57, 0.15);
            color: var(--primary-color);
        }

        /* Root folder special styling */
        .folder-option[data-folder-id=""] {
            background: rgba(47, 79, 57, 0.05);
            border-left-color: var(--primary-color);
            font-weight: 600;
        }

        .folder-option[data-folder-id=""]:hover {
            background: rgba(47, 79, 57, 0.08);
        }

        .folder-option[data-folder-id=""] .folder-icon {
            color: var(--primary-color);
        }

        /* Folder Indentation */
        .folder-indent {
            width: 20px;
            flex-shrink: 0;
        }

        /* Loading and Error States */
        .loading-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            color: var(--text-secondary);
        }

        .loading-spinner {
            width: 32px;
            height: 32px;
            border: 3px solid var(--background-light);
            border-top: 3px solid var(--primary-color);
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 16px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .error-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 32px 24px;
            color: #ff4d4f;
            text-align: center;
        }

        .error-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.6;
        }

        .empty-state {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 48px 24px;
            color: var(--text-secondary);
            text-align: center;
        }

        .empty-state svg {
            width: 48px;
            height: 48px;
            margin-bottom: 16px;
            opacity: 0.3;
        }

        /* Quick Actions */
        .folder-quick-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 12px;
            padding-top: 12px;
            border-top: 1px solid var(--border-color);
        }

        .selected-info {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: rgba(47, 79, 57, 0.08);
            border-radius: 16px;
            font-size: 13px;
            color: var(--primary-color);
            font-weight: 500;
        }

        .selected-info::before {
            content: '‚úì';
            display: flex;
            align-items: center;
            justify-content: center;
            width: 16px;
            height: 16px;
            background: var(--primary-color);
            color: white;
            border-radius: 50%;
            font-size: 10px;
        }

        /* Modal Footer */
        .modal-footer {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 12px;
            padding: 16px 24px;
            border-top: 1px solid var(--border-color);
            background: rgba(248, 248, 248, 0.8);
        }

        /* Button Styles */
        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
            padding: 8px 16px;
            border: 1px solid var(--border-color);
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-decoration: none;
            background: white;
            color: var(--text-color);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none !important;
        }

        .btn-primary {
            background: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .btn-primary:hover:not(:disabled) {
            background: var(--primary-hover);
            border-color: var(--primary-hover);
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(47, 79, 57, 0.3);
        }

        .btn-secondary {
            background: white;
            color: var(--text-secondary);
            border-color: var(--border-color);
        }

        .btn-secondary:hover:not(:disabled) {
            background: var(--background-light);
            color: var(--text-color);
        }

        .btn-outline {
            background: transparent;
            color: var(--primary-color);
            border-color: var(--primary-color);
        }

        .btn-outline:hover:not(:disabled) {
            background: rgba(47, 79, 57, 0.04);
        }

        
        /* Responsive Design */
        @media (max-width: 768px) {
            .folder-breadcrumb {
                font-size: 12px;
                padding: 6px 8px;
            }

            .folder-option {
                padding: 10px 12px;
                gap: 8px;
            }

            .folder-list {
                max-height: 300px;
            }

            .folder-quick-actions {
                flex-direction: column;
                align-items: stretch;
                gap: 8px;
            }

            .modal-footer {
                padding: 12px 16px;
                gap: 8px;
            }

            .btn {
                padding: 8px 12px;
                font-size: 13px;
            }
        }

        /* Responsive adjustments */
        @media (max-width: 1024px) {
            . {
                flex-direction: column;
            }

            . {
                width: 100%;
                max-height: 300px;
            }
        }

        @media (max-width: 768px) {
            . {
                gap: 16px;
            }

            . {
                max-height: 250px;
            }

            .-header {
                padding: 12px 16px;
            }

            .-node {
                padding: 6px 16px;
            }

            .-children .-node {
                padding-left: 32px;
            }
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 16px;
                gap: 12px;
            }

            .main-nav {
                gap: 4px;
                flex-wrap: wrap;
                justify-content: flex-start;
            }

            .nav-link {
                padding: 6px 8px;
                font-size: 12px;
            }

            .app-content {
                padding: 16px;
            }

            .page-header {
                flex-direction: column;
                align-items: stretch;
            }

            .documents-grid {
                grid-template-columns: 1fr;
            }

            .modal-content {
                width: 95%;
                margin: 20px;
            }
        }

        @media (max-width: 480px) {
            .header-content {
                padding: 0 8px;
                gap: 8px;
                position: relative;
            }

            .main-nav {
                display: none;
            }

            .user-name {
                display: none;
            }

            .menu-toggle {
                display: block;
            }

            .user-menu {
                position: relative;
            }
        }
    </style>
</head>
<body>
    <div class="app-layout">
        <header class="app-header">
            <div class="header-content">
                <button class="menu-toggle" id="menuToggle" aria-label="Toggle navigation menu">‚ò∞</button>
                <a href="/dashboard/" class="logo">SuperEditor</a>
                <nav class="main-nav">
                    <a href="/my-documents/" class="nav-link active">ÊàëÁöÑÊñáÊ°£</a>
                    <a href="/my-images/" class="nav-link">ÊàëÁöÑÂõæÁâá</a>
                    <a href="/my-files/" class="nav-link">ÊàëÁöÑÊñá‰ª∂</a>
                    <a href="/system-settings/" class="nav-link">Á≥ªÁªüËÆæÁΩÆ</a>
                    <a href="/user-settings/" class="nav-link">Áî®Êà∑ËÆæÁΩÆ</a>
                </nav>
                <div class="user-menu">
                    <span class="user-name" id="userName">Loading...</span>
                    <button type="button" class="btn btn-secondary" id="logoutBtn">ÈÄÄÂá∫ÁôªÂΩï</button>
                </div>
            </div>
            <!-- Mobile menu -->
            <div class="mobile-menu" id="mobileMenu">
                <a href="/my-documents/" class="mobile-nav-link">ÊàëÁöÑÊñáÊ°£</a>
                <a href="/my-images/" class="mobile-nav-link">ÊàëÁöÑÂõæÁâá</a>
                <a href="/my-files/" class="mobile-nav-link">ÊàëÁöÑÊñá‰ª∂</a>
                <a href="/system-settings/" class="mobile-nav-link">Á≥ªÁªüËÆæÁΩÆ</a>
                <a href="/user-settings/" class="mobile-nav-link">Áî®Êà∑ËÆæÁΩÆ</a>
                <button class="mobile-nav-link" id="mobileLogoutBtn" style="background: none; border: none; text-align: left; cursor: pointer;">ÈÄÄÂá∫ÁôªÂΩï</button>
            </div>
        </header>

        <div class="app-content">
            <div class="page-header">
                <div>
                    <h1 class="page-title">ÊàëÁöÑÊñáÊ°£</h1>
                    <p class="page-subtitle">ÁÆ°ÁêÜÊÇ®ÁöÑÊâÄÊúâÊñáÊ°£ÂÜÖÂÆπÔºåÊîØÊåÅ Markdown ÁºñËæëÂíåÈ¢ÑËßà</p>
                </div>
                <div style="display: flex; gap: 12px;">
                    <button type="button" class="btn btn-secondary btn-lg" id="newFolderBtn">
                        <span>üìÅ</span>
                        <span>Êñ∞Âª∫Êñá‰ª∂Â§π</span>
                    </button>
                    <button type="button" class="btn btn-primary btn-lg" id="newDocumentBtn">
                        <span>‚ûï</span>
                        <span>Êñ∞Âª∫ÊñáÊ°£</span>
                    </button>
                </div>
            </div>

            <!-- Main Content Area -->
            <div class="main-content" style="margin-left: 0;">
                <!-- Breadcrumb navigation -->
                <nav class="breadcrumb" id="breadcrumb">
                    <!-- Breadcrumb items will be loaded here -->
                </nav>

                <div class="documents-grid" id="documentsContainer">
                    <!-- Folders and documents will be loaded here -->
                </div>

                <!-- Pagination controls -->
                <div class="pagination-container" id="paginationContainer">
                    <!-- Pagination will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Document Viewer Modal -->
    <div id="documentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="documentViewerTitle">ÊñáÊ°£È¢ÑËßà</h2>
                <div class="modal-header-actions">
                    <button type="button" class="btn btn-sm btn-secondary" id="copyDocumentBtn" title="Â§çÂà∂ÊñáÊ°£ÂÜÖÂÆπ">
                        <span>Â§çÂà∂</span>
                    </button>
                    <button type="button" class="modal-close" id="modalClose">&times;</button>
                </div>
            </div>
            <div class="modal-body">
                <div class="document-viewer">
                    <div class="document-viewer-content" id="documentViewerContent">
                        ÊñáÊ°£ÂÜÖÂÆπÂ∞ÜÂú®ËøôÈáåÊòæÁ§∫
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create/Edit Folder Modal -->
    <div id="folderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="folderModalTitle">Êñ∞Âª∫Êñá‰ª∂Â§π</h2>
                <button type="button" class="modal-close" id="folderModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <form id="folderForm">
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Êñá‰ª∂Â§πÂêçÁß∞</label>
                        <input type="text" id="folderName" placeholder="ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞" required
                               style="width: 100%; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px;">
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">ÊèèËø∞ÔºàÂèØÈÄâÔºâ</label>
                        <textarea id="folderDescription" placeholder="ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÊèèËø∞" rows="3"
                                  style="width: 100%; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px; resize: vertical;"></textarea>
                    </div>
                    <div style="margin-bottom: 16px;">
                        <label style="display: block; margin-bottom: 8px; font-weight: 500;">Áà∂Êñá‰ª∂Â§πÔºàÂèØÈÄâÔºâ</label>
                        <select id="folderParent" style="width: 100%; padding: 8px 12px; border: 1px solid var(--border-color); border-radius: 4px; font-size: 14px;">
                            <option value="">Ê†πÁõÆÂΩï</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-header" style="border-top: 1px solid var(--border-color); padding: 16px 24px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" id="folderModalCancel">ÂèñÊ∂à</button>
                <button type="button" class="btn btn-primary" id="folderModalSave" style="margin-left: 8px;">‰øùÂ≠ò</button>
            </div>
        </div>
    </div>

    <!-- Move Document Modal -->
    <div id="moveDocumentModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÁßªÂä®ÊñáÊ°£</h2>
                <button type="button" class="modal-close" id="moveModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Search Bar -->
                <div class="folder-search-container">
                    <div class="search-input-wrapper">
                        <svg class="search-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <input
                            type="text"
                            id="folderSearchInput"
                            class="folder-search-input"
                            placeholder="ÊêúÁ¥¢Êñá‰ª∂Â§π..."
                            autocomplete="off"
                        >
                        <button type="button" class="search-clear-btn" id="searchClearBtn" style="display: none;">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                                <line x1="18" y1="6" x2="6" y2="18"></line>
                                <line x1="6" y1="6" x2="18" y2="18"></line>
                            </svg>
                        </button>
                    </div>
                </div>

                <!-- Breadcrumb Navigation -->
                <div class="folder-breadcrumb" id="folderBreadcrumb">
                    <div class="breadcrumb-item active">
                        <svg class="breadcrumb-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                            <polyline points="9 22 9 12 15 12 15 22"></polyline>
                        </svg>
                        <span>Ê†πÁõÆÂΩï</span>
                    </div>
                </div>

                <!-- Folder List -->
                <div class="folder-list-container">
                    <div class="folder-list" id="moveFolderList">
                        <div class="loading-state">
                            <div class="loading-spinner"></div>
                            <p>Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂Â§πÂàóË°®...</p>
                        </div>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="folder-quick-actions">
                    <button type="button" class="btn btn-outline btn-sm" id="createNewFolderBtn">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 14px; height: 14px; margin-right: 6px;">
                            <line x1="12" y1="5" x2="12" y2="19"></line>
                            <line x1="5" y1="12" x2="19" y2="12"></line>
                        </svg>
                        Êñ∞Âª∫Êñá‰ª∂Â§π
                    </button>
                    <div class="selected-info" id="selectedFolderInfo" style="display: none;">
                        <span id="selectedFolderName"></span>
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" id="moveModalCancel">ÂèñÊ∂à</button>
                <button type="button" class="btn btn-primary" id="moveModalConfirm" disabled>
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 6px;">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    ÁßªÂä®
                </button>
            </div>
        </div>
    </div>

    <!-- Rename Folder Modal -->
    <div id="renameFolderModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">ÈáçÂëΩÂêçÊñá‰ª∂Â§π</h2>
                <button type="button" class="modal-close" id="renameModalClose">&times;</button>
            </div>
            <div class="modal-body">
                <div style="margin-bottom: 16px;">
                    <label for="renameFolderName" style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">Êñá‰ª∂Â§πÂêçÁß∞Ôºö</label>
                    <input type="text" id="renameFolderName" class="form-input" placeholder="ËØ∑ËæìÂÖ•Êñ∞ÁöÑÊñá‰ª∂Â§πÂêçÁß∞" maxlength="100" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: white;">
                </div>
                <div style="margin-bottom: 16px;">
                    <label for="renameFolderDescription" style="display: block; margin-bottom: 8px; font-weight: 500; color: var(--text-color);">Êñá‰ª∂Â§πÊèèËø∞ÔºàÂèØÈÄâÔºâÔºö</label>
                    <textarea id="renameFolderDescription" class="form-input" placeholder="ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÊèèËø∞" maxlength="500" rows="3" style="width: 100%; padding: 12px; border: 1px solid var(--border-color); border-radius: 8px; font-size: 14px; background: white; resize: vertical;"></textarea>
                </div>
            </div>
            <div class="modal-header" style="border-top: 1px solid var(--border-color); padding: 16px 24px; justify-content: flex-end;">
                <button type="button" class="btn btn-secondary" id="renameModalCancel">ÂèñÊ∂à</button>
                <button type="button" class="btn btn-primary" id="renameModalConfirm" style="margin-left: 8px;">Á°ÆËÆ§ÈáçÂëΩÂêç</button>
            </div>
        </div>
    </div>

    <script src="https://unpkg.com/marked@12.0.0/marked.min.js"></script>
    <script src="https://unpkg.com/@highlightjs/cdn-assets@11.9.0/highlight.min.js"></script>
    <script src="https://unpkg.com/katex@0.16.9/dist/katex.min.js"></script>
    <script>
        // Configure marked with custom renderer for enhanced features
        const renderer = new marked.Renderer();

        // Enhanced headings with IDs
        renderer.heading = function(text, level) {
            const escapedText = text.toLowerCase().replace(/[^\w]+/g, '-');
            return `<h${level} id="${escapedText}">${text}</h${level}>`;
        };

        // Enhanced images with lazy loading and error handling
        renderer.image = function(href, title, text) {
            const titleAttr = title ? ` title="${title}"` : '';
            const altAttr = text ? ` alt="${text}"` : ' alt="Image"';
            return `<img src="${href}"${titleAttr}${altAttr} loading="lazy" style="max-width: 100%; height: auto; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.15);" onerror="this.alt='Image not found: ' + this.src; this.style.border='1px solid var(--border-color)'; this.style.padding='10px'; this.style.backgroundColor='#f9f9f9';">`;
        };

        // Enhanced links with external icon
        renderer.link = function(href, title, text) {
            const isExternal = href && (href.startsWith('http') || href.startsWith('//'));
            const titleAttr = title ? ` title="${title}"` : '';
            const externalIcon = isExternal ? '<span class="external-link"></span>' : '';
            return `<a href="${href}"${titleAttr} target="${isExternal ? '_blank' : '_self'}" rel="${isExternal ? 'noopener noreferrer' : ''}">${text}${externalIcon}</a>`;
        };

        // Enhanced code blocks with copy functionality
        renderer.code = function(code, language) {
            const validLanguage = hljs.getLanguage(language) ? language : 'plaintext';
            const highlightedCode = hljs.highlight(code, { language: validLanguage }).value;
            const copyId = 'copy-' + Math.random().toString(36).substr(2, 9);

            return `
                <div class="code-block-wrapper">
                    <button class="copy-button" onclick="copyCode('${copyId}', this)" title="Â§çÂà∂‰ª£Á†Å">Â§çÂà∂</button>
                    <pre><code id="${copyId}" class="hljs language-${validLanguage}">${highlightedCode}</code></pre>
                </div>
            `;
        };

        // Enhanced tables
        renderer.table = function(header, body) {
            return `
                <div class="table-wrapper">
                    <table>
                        <thead>${header}</thead>
                        <tbody>${body}</tbody>
                    </table>
                </div>
            `;
        };

        // Configure marked options
        marked.setOptions({
            renderer: renderer,
            highlight: function(code, lang) {
                const language = hljs.getLanguage(lang) ? lang : 'plaintext';
                return hljs.highlight(code, { language }).value;
            },
            langPrefix: 'hljs language-',
            pedantic: false,
            gfm: true,
            breaks: true,
            sanitize: false,
            smart: true,
            smartLists: true,
            smartypants: true
        });

        // Enhanced markdown parser function
        function parseMarkdown(text) {
            if (!text) return '';

            try {
                // Process math expressions before marked
                let processedText = processMathExpressions(text);

                // Parse markdown
                let html = marked.parse(processedText);

                return html;
            } catch (error) {
                console.error('Markdown parsing error:', error);
                return `<p>Markdown Ëß£ÊûêÈîôËØØ: ${error.message}</p>`;
            }
        }

        // Process LaTeX math expressions
        function processMathExpressions(text) {
            // Process display math ($$...$$)
            text = text.replace(/\$\$([\s\S]*?)\$\$/g, (match, math) => {
                try {
                    return katex.renderToString(math, {
                        displayMode: true,
                        throwOnError: false
                    });
                } catch (e) {
                    return `<span class="math-error">Êï∞Â≠¶ÂÖ¨ÂºèÈîôËØØ: ${e.message}</span>`;
                }
            });

            // Process inline math ($...$)
            text = text.replace(/\$([^\$\n]+?)\$/g, (match, math) => {
                try {
                    return katex.renderToString(math, {
                        displayMode: false,
                        throwOnError: false
                    });
                } catch (e) {
                    return `<span class="math-error">Êï∞Â≠¶ÂÖ¨ÂºèÈîôËØØ: ${e.message}</span>`;
                }
            });

            return text;
        }

        // Copy code functionality
        function copyCode(elementId, button) {
            const codeElement = document.getElementById(elementId);
            if (codeElement) {
                navigator.clipboard.writeText(codeElement.textContent).then(() => {
                    button.textContent = 'Â∑≤Â§çÂà∂';
                    button.classList.add('copied');
                    setTimeout(() => {
                        button.textContent = 'Â§çÂà∂';
                        button.classList.remove('copied');
                    }, 2000);
                }).catch(err => {
                    console.error('Â§çÂà∂Â§±Ë¥•:', err);
                    alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÊã©‰ª£Á†ÅÂ§çÂà∂');
                });
            }
        }

        // Utility function to escape HTML
        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        // Pagination state
        let currentPage = 1;
        let totalPages = 1;
        let totalRecords = 0;
        const pageSize = 12;

        // Folder state
        let currentFolderId = null; // ÂΩìÂâçÈÄâ‰∏≠ÁöÑÊñá‰ª∂Â§πIDÔºånullË°®Á§∫ÊòæÁ§∫ÊâÄÊúâÊñáÊ°£
        let folders = []; // Êñá‰ª∂Â§πÂàóË°®
        let folderTree = []; // Êñá‰ª∂Â§πÊ†ëÂΩ¢ÁªìÊûÑ

        document.addEventListener('DOMContentLoaded', () => {
            // Initialize mobile menu
            initMobileMenu();


            // Load user information and check authentication
            loadUserInfo();

            // Load folders and documents
            loadFoldersAndDocuments();

            // Event listeners
            document.getElementById('newDocumentBtn').addEventListener('click', () => {
                window.location.href = '/editor/';
            });

            document.getElementById('newFolderBtn').addEventListener('click', () => {
                showCreateFolderModal();
            });

            document.getElementById('logoutBtn').addEventListener('click', async () => {
                await handleLogout();
            });

            // Modal event listeners
            document.getElementById('modalClose').addEventListener('click', () => {
                document.getElementById('documentModal').classList.remove('show');
            });

            // Copy document button event listener
            document.getElementById('copyDocumentBtn').addEventListener('click', async () => {
                const contentElement = document.getElementById('documentViewerContent');
                if (contentElement) {
                    try {
                        // Create a temporary element to hold the styled content
                        const tempElement = document.createElement('div');
                        tempElement.innerHTML = contentElement.innerHTML;

                        // Remove copy buttons from code blocks if they exist
                        const copyButtons = tempElement.querySelectorAll('.copy-button');
                        copyButtons.forEach(button => button.remove());

                        // Get all CSS rules that might affect the document content
                        const cssRules = [];

                        // Helper function to get CSS text from rules
                        const getRuleText = (rule) => {
                            try {
                                if (rule.cssText) return rule.cssText;
                                if (rule.style && rule.selectorText) {
                                    return `${rule.selectorText} { ${rule.style.cssText} }`;
                                }
                                return '';
                            } catch (e) {
                                return '';
                            }
                        };

                        // Collect relevant CSS rules from all stylesheets
                        for (let i = 0; i < document.styleSheets.length; i++) {
                            try {
                                const sheet = document.styleSheets[i];
                                for (let j = 0; j < sheet.cssRules.length; j++) {
                                    const rule = sheet.cssRules[j];
                                    const ruleText = getRuleText(rule);

                                    // Include rules for markdown elements and document viewer
                                    if (ruleText && (
                                        ruleText.includes('document-viewer') ||
                                        ruleText.includes('hljs') ||
                                        ruleText.includes('katex') ||
                                        ruleText.includes('markdown') ||
                                        ruleText.includes('table') ||
                                        ruleText.includes('code') ||
                                        ruleText.includes('pre') ||
                                        ruleText.includes('h1') ||
                                        ruleText.includes('h2') ||
                                        ruleText.includes('h3') ||
                                        ruleText.includes('h4') ||
                                        ruleText.includes('h5') ||
                                        ruleText.includes('h6') ||
                                        ruleText.includes('p') ||
                                        ruleText.includes('blockquote') ||
                                        ruleText.includes('ul') ||
                                        ruleText.includes('ol') ||
                                        ruleText.includes('li') ||
                                        ruleText.includes('a') ||
                                        ruleText.includes('img') ||
                                        ruleText.includes('strong') ||
                                        ruleText.includes('em') ||
                                        ruleText.includes('hr') ||
                                        ruleText.includes('.table') ||
                                        ruleText.includes('.thead') ||
                                        ruleText.includes('.tbody') ||
                                        ruleText.includes('.tr') ||
                                        ruleText.includes('.td') ||
                                        ruleText.includes('.th')
                                    )) {
                                        cssRules.push(ruleText);
                                    }
                                }
                            } catch (e) {
                                // Skip inaccessible stylesheets (CORS issues)
                                continue;
                            }
                        }

                        // Also include inline styles from the document content
                        const inlineStyles = contentElement.getAttribute('style') || '';

                        // Create HTML with embedded styles
                        const styledHTML = `<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>ÊñáÊ°£ÂÜÖÂÆπ</title>
    <style>
        /* CSS Variables */
        :root {
            --primary-color: #2f4f39;
            --primary-hover: #5a7a61;
            --primary-light: #7a9a81;
            --text-color: #1a1a1a;
            --text-secondary: #666666;
            --border-color: #e0e0e0;
            --background-color: #ffffff;
            --background-light: #f8f8f8;
            --shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
        }

        /* Base styles */
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            color: var(--text-color);
            background-color: var(--background-color);
            margin: 0;
            padding: 20px;
            max-width: 800px;
            margin: 0 auto;
        }

        /* Document viewer specific styles */
        .document-viewer-content {
            font-size: 16px;
            color: var(--text-color);
        }

        /* Headings */
        h1, h2, h3, h4, h5, h6 {
            margin-top: 24px;
            margin-bottom: 16px;
            font-weight: 600;
            color: var(--text-color);
        }

        h1 { font-size: 28px; }
        h2 { font-size: 24px; }
        h3 { font-size: 20px; }
        h4 { font-size: 18px; }
        h5 { font-size: 16px; }
        h6 { font-size: 14px; }

        /* Paragraphs */
        p {
            margin-bottom: 16px;
            color: var(--text-color);
        }

        /* Links */
        a {
            color: var(--primary-color);
            text-decoration: none;
        }

        a:hover {
            color: var(--primary-hover);
            text-decoration: underline;
        }

        /* Blockquotes */
        blockquote {
            margin: 16px 0;
            padding: 12px 20px;
            border-left: 4px solid var(--primary-color);
            background-color: var(--background-light);
            color: var(--text-secondary);
        }

        /* Lists */
        ul, ol {
            margin-bottom: 16px;
            padding-left: 24px;
        }

        li {
            margin-bottom: 8px;
        }

        /* Code blocks */
        pre {
            background-color: #f6f8fa;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 16px;
            overflow-x: auto;
            margin: 16px 0;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
            line-height: 1.5;
        }

        code {
            background-color: #f6f8fa;
            padding: 2px 4px;
            border-radius: 4px;
            font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, monospace;
            font-size: 14px;
        }

        pre code {
            background: none;
            padding: 0;
            border-radius: 0;
        }

        /* Syntax highlighting */
        .hljs {
            background: #f6f8fa !important;
            color: #24292e !important;
        }

        /* Tables */
        table {
            width: 100%;
            border-collapse: collapse;
            margin: 16px 0;
            font-size: 14px;
        }

        th, td {
            border: 1px solid var(--border-color);
            padding: 12px;
            text-align: left;
        }

        th {
            background-color: var(--background-light);
            font-weight: 600;
            color: var(--text-color);
        }

        /* Horizontal rule */
        hr {
            border: none;
            border-top: 1px solid var(--border-color);
            margin: 24px 0;
        }

        /* Images */
        img {
            max-width: 100%;
            height: auto;
            border-radius: 8px;
            margin: 16px 0;
        }

        /* Emphasis */
        strong {
            font-weight: 600;
            color: var(--text-color);
        }

        em {
            font-style: italic;
            color: var(--text-secondary);
        }

        /* Additional styles from page */
        ${cssRules.join('\n')}

        /* Content specific styles */
        ${inlineStyles}
    </style>
</head>
<body>
    <div class="document-viewer-content">
        ${tempElement.innerHTML}
    </div>
</body>
</html>`;

                        // Create a blob with the styled HTML
                        const htmlBlob = new Blob([styledHTML], { type: 'text/html;charset=utf-8' });
                        const textBlob = new Blob([tempElement.innerText || tempElement.textContent], { type: 'text/plain;charset=utf-8' });

                        // Use the clipboard API for rich content
                        if (navigator.clipboard && window.ClipboardItem) {
                            const clipboardItem = new ClipboardItem({
                                'text/html': htmlBlob,
                                'text/plain': textBlob
                            });

                            await navigator.clipboard.write([clipboardItem]);
                        } else {
                            // Fallback: copy HTML as text
                            await navigator.clipboard.writeText(styledHTML);
                        }

                        // Update button to show success
                        const copyBtn = document.getElementById('copyDocumentBtn');
                        const originalContent = copyBtn.innerHTML;
                        copyBtn.innerHTML = '<span>Â∑≤Â§çÂà∂</span>';
                        copyBtn.classList.add('btn-success');
                        copyBtn.classList.remove('btn-secondary');

                        // Reset button after 2 seconds
                        setTimeout(() => {
                            copyBtn.innerHTML = originalContent;
                            copyBtn.classList.remove('btn-success');
                            copyBtn.classList.add('btn-secondary');
                        }, 2000);

                    } catch (err) {
                        console.error('Â§çÂà∂Â§±Ë¥•:', err);
                        // Fallback to copying HTML as text if rich clipboard fails
                        try {
                            const tempElement = document.createElement('div');
                            tempElement.innerHTML = contentElement.innerHTML;
                            const copyButtons = tempElement.querySelectorAll('.copy-button');
                            copyButtons.forEach(button => button.remove());

                            await navigator.clipboard.writeText(tempElement.innerHTML);
                            alert('HTMLÂÜÖÂÆπÂ∑≤Â§çÂà∂ÔºàÁ∫ØÊñáÊú¨Ê†ºÂºèÔºâ');
                        } catch (fallbackErr) {
                            alert('Â§çÂà∂Â§±Ë¥•ÔºåËØ∑ÊâãÂä®ÈÄâÊã©ÂÜÖÂÆπÂ§çÂà∂');
                        }
                    }
                }
            });

            window.addEventListener('click', (event) => {
                const modal = document.getElementById('documentModal');
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });

            // Folder-related event listeners
            initFolderEventListeners();
        });

        async function loadUserInfo() {
            try {
                const response = await fetch('/api/auth/me', {
                    credentials: 'include' // Include cookies in the request
                });

                const data = await response.json();

                if (response.ok) {
                    // Update username display
                    document.getElementById('userName').textContent = data.name || data.email || 'User';
                } else {
                    // If not authenticated, redirect to login
                    if (response.status === 401) {
                        window.location.href = '/login/';
                        return;
                    }
                    // Handle other errors
                    document.getElementById('userName').textContent = 'User';
                    console.error('Failed to load user info:', data.error);
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                document.getElementById('userName').textContent = 'User';

                // If network error, also redirect to login as user might not be authenticated
                window.location.href = '/login/';
            }
        }

        async function loadFoldersAndDocuments(page = 1) {
            try {
                // Load folders
                const foldersResponse = await fetch('/api/folders/tree', {
                    credentials: 'include'
                });

                const foldersData = await foldersResponse.json();

                if (foldersResponse.ok) {
                    folderTree = foldersData.tree || [];
                    folders = flattenFolderTree(folderTree);
                } else {
                    console.error('Failed to load folders:', foldersData.error);
                }

                // Determine what to show
                const foldersToShow = currentFolderId ? [] : folders.filter(folder => !folder.parent_id);

                let documentsToUse = [];
                let adjustedCurrentPage = page;
                let adjustedTotalPages = 1;
                let adjustedTotalRecords = 0;

                if (!currentFolderId && foldersToShow.length > 0) {
                    // Home page: We need to handle folders + documents manually

                    // Get documents that are not in any folder (root level documents)
                    let allDocumentsUrl = '/api/documents?limit=1000';
                    // For home page, we want documents without folder_id (null or empty)
                    allDocumentsUrl += '&folder_id=null';

                    const allDocumentsResponse = await fetch(allDocumentsUrl, {
                        credentials: 'include'
                    });
                    const allDocumentsData = await allDocumentsResponse.json();

                    if (allDocumentsResponse.ok) {
                        const allDocuments = allDocumentsData.documents;

                        // Calculate total including folders
                        adjustedTotalRecords = foldersToShow.length + allDocuments.length;
                        adjustedTotalPages = Math.ceil(adjustedTotalRecords / pageSize);

                        // Calculate which items to show on this page
                        const startIndex = (page - 1) * pageSize;
                        const endIndex = Math.min(startIndex + pageSize, adjustedTotalRecords);

                        // Get the documents for this page range
                        const documentStartIndex = Math.max(0, startIndex - foldersToShow.length);
                        const documentEndIndex = Math.min(allDocuments.length, endIndex - foldersToShow.length);

                        if (documentStartIndex < documentEndIndex) {
                            documentsToUse = allDocuments.slice(documentStartIndex, documentEndIndex);
                        }
                    }
                } else {
                    // Folder view or no folders: Use normal pagination
                    let apiUrl = `/api/documents?page=${page}&limit=${pageSize}`;

                    // If in a folder, filter documents by folder_id
                    if (currentFolderId) {
                        apiUrl += `&folder_id=${currentFolderId}`;
                    } else {
                        // Home page with no folders: show root-level documents only
                        apiUrl += `&folder_id=null`;
                    }

                    const documentsResponse = await fetch(apiUrl, {
                        credentials: 'include'
                    });
                    const documentsData = await documentsResponse.json();

                    if (documentsResponse.ok) {
                        documentsToUse = documentsData.documents;
                        adjustedCurrentPage = documentsData.pagination.currentPage;
                        adjustedTotalPages = documentsData.pagination.totalPages;
                        adjustedTotalRecords = documentsData.pagination.totalRecords;
                    }
                }

                // Update pagination state
                currentPage = page;
                totalPages = adjustedTotalPages;
                totalRecords = adjustedTotalRecords;

                renderFoldersAndDocuments(documentsToUse);
                renderPagination();
            } catch (error) {
                console.error('Error loading data:', error);
                document.getElementById('documentsContainer').innerHTML =
                    `<p>Error loading data: ${error.message}</p>`;
                document.getElementById('paginationContainer').innerHTML = '';
            }
        }

        function renderFoldersAndDocuments(documents) {
            const container = document.getElementById('documentsContainer');
            container.innerHTML = '';

            // Render breadcrumb
            renderBreadcrumb();

            // Show folders based on current context
            let foldersToShow = [];
            if (currentFolderId) {
                // When inside a folder, show its direct sub-folders
                foldersToShow = folders.filter(folder => folder.parent_id === currentFolderId);
            } else if (currentPage === 1) {
                // When at root level on first page, show root-level folders
                foldersToShow = folders.filter(folder => !folder.parent_id);
            }

            const hasContent = foldersToShow.length > 0 || documents.length > 0;

            if (!hasContent) {
                let emptyMessage = currentFolderId ? 'Ê≠§Êñá‰ª∂Â§πÊöÇÊó†ÊñáÊ°£' : 'ÊöÇÊó†ÂÜÖÂÆπ';
                let emptyDescription = currentFolderId ?
                    'Âú®Ê≠§Êñá‰ª∂Â§π‰∏≠ÂàõÂª∫Á¨¨‰∏Ä‰∏™ÊñáÊ°£ÂêßÔºÅ' :
                    'ÂàõÂª∫ÊÇ®ÁöÑÁ¨¨‰∏Ä‰∏™Êñá‰ª∂Â§πÊàñÊñáÊ°£ÂºÄÂßã‰ΩøÁî®ÂêßÔºÅ';

                container.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-state-icon">üìÅ</div>
                        <div class="empty-state-title">${emptyMessage}</div>
                        <div class="empty-state-description">${emptyDescription}</div>
                        <div style="display: flex; gap: 12px; justify-content: center;">
                            ${!currentFolderId ? `
                                <button type="button" class="btn btn-secondary btn-lg" onclick="document.getElementById('newFolderBtn').click()">
                                    <span>üìÅ</span>
                                    <span>ÂàõÂª∫Êñá‰ª∂Â§π</span>
                                </button>
                            ` : ''}
                            <button type="button" class="btn btn-primary btn-lg" onclick="document.getElementById('newDocumentBtn').click()">
                                <span>‚ûï</span>
                                <span>ÂàõÂª∫ÊñáÊ°£</span>
                            </button>
                        </div>
                    </div>
                `;
                return;
            }

            // Render folders first
            if (foldersToShow.length > 0) {
                foldersToShow.forEach(folder => {
                    const card = createFolderCard(folder);
                    container.appendChild(card);
                });
            }

            // Render documents
            documents.forEach(doc => {
                const card = createDocumentCard(doc);
                container.appendChild(card);
            });
        }

        function createFolderCard(folder) {
            const card = document.createElement('div');
            card.className = 'folder-card';

            const title = escapeHtml(folder.name);
            const description = folder.description ? escapeHtml(folder.description) : '';

            // ÂÆâÂÖ®Â§ÑÁêÜÂàõÂª∫Êó∂Èó¥ - ‰ºòÂÖà‰ΩøÁî®created_atÔºåÂ¶ÇÊûúÊ≤°ÊúâÂàô‰ΩøÁî®updated_at
            let createdDate = 'Êú™Áü•Êó∂Èó¥';
            try {
                // Ê†πÊçÆÊï∞ÊçÆÂ∫ìschemaÔºåÂ≠óÊÆµÂ∫îËØ•ÊòØcreated_atÂíåupdated_at
                const dateField = folder.created_at || folder.updated_at;

                if (dateField) {
                    const date = new Date(dateField);
                    if (!isNaN(date.getTime())) {
                        // ÊòæÁ§∫Êõ¥ËØ¶ÁªÜÁöÑÊó•ÊúüÊ†ºÂºèÔºöÂπ¥-Êúà-Êó• Êó∂:ÂàÜ
                        createdDate = date.toLocaleString('zh-CN', {
                            year: 'numeric',
                            month: '2-digit',
                            day: '2-digit',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                    }
                } else {
                    console.warn('Folder missing timestamp fields:', folder.id);
                }
            } catch (error) {
                console.warn('Error processing folder date for folder', folder.id, ':', error);
            }

            const documentCount = folder.document_count || 0;

            card.innerHTML = `
                <div class="folder-card-body">
                    <div class="folder-card-header">
                        <div class="folder-icon">üìÅ</div>
                        <div class="folder-title" title="${title}">${title}</div>
                    </div>
                    <div class="folder-meta">ÂàõÂª∫Êó∂Èó¥: ${createdDate}</div>
                    ${description ? `<div class="folder-meta" style="margin-top: 4px;">${description}</div>` : ''}
                    <div class="folder-meta" style="margin-top: 4px;">üìÑ ${documentCount} ‰∏™ÊñáÊ°£</div>
                    <div class="document-actions">
                        <button class="btn btn-success btn-sm" onclick="openFolder('${folder.id}')">
                            <span>üìÇ</span>
                            <span>ÊâìÂºÄ</span>
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showRenameFolderModal('${folder.id}')">
                            <span>‚úèÔ∏è</span>
                            <span>ÈáçÂëΩÂêç</span>
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showMoveFolderModal('${folder.id}')">
                            <span>üìÅ</span>
                            <span>ÁßªÂä®</span>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteFolder('${folder.id}', '${title}')">
                            <span>üóëÔ∏è</span>
                            <span>Âà†Èô§</span>
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        function createDocumentCard(doc) {
            const card = document.createElement('div');
            card.className = 'document-card';
            card.style.position = 'relative';

            const title = escapeHtml(doc.title);
            const lastEdited = new Date(doc.updated_at).toLocaleDateString('zh-CN');

            // Ëé∑ÂèñÊñáÊ°£ÊâÄÂú®Êñá‰ª∂Â§πÂêçÁß∞
            const folderName = getDocumentFolderName(doc.folder_id);
            const folderBadge = folderName ? `<div class="document-folder-badge">${escapeHtml(folderName)}</div>` : '';

            card.innerHTML = `
                ${folderBadge}
                <div class="document-card-body">
                    <div class="document-title" title="${title}">${title}</div>
                    <div class="document-meta">ÊúÄÂêéÁºñËæë: ${lastEdited}</div>
                    <div class="document-actions">
                        <button class="btn btn-success btn-sm" onclick="editDocument('${doc.id}')">
                            <span>‚úèÔ∏è</span>
                            <span>ÁºñËæë</span>
                        </button>
                        <button class="btn btn-sm" onclick="viewDocument('${doc.id}', '${title}')">
                            <span>üëÅÔ∏è</span>
                            <span>È¢ÑËßà</span>
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="showMoveDocumentModal('${doc.id}')">
                            <span>üìÅ</span>
                            <span>ÁßªÂä®</span>
                        </button>
                        <button class="btn btn-danger btn-sm" onclick="deleteDocument('${doc.id}', '${title}')">
                            <span>üóëÔ∏è</span>
                            <span>Âà†Èô§</span>
                        </button>
                    </div>
                </div>
            `;
            return card;
        }

        function renderPagination() {
            const container = document.getElementById('paginationContainer');
            container.innerHTML = '';

            // Don't render pagination if there's only one page or no documents
            if (totalPages <= 1) {
                return;
            }

            // Pagination info
            const startRecord = (currentPage - 1) * pageSize + 1;
            const endRecord = Math.min(currentPage * pageSize, totalRecords);

            const paginationInfo = document.createElement('div');
            paginationInfo.className = 'pagination-info';
            paginationInfo.textContent = `ÊòæÁ§∫ ${startRecord}-${endRecord} Êù°ÔºåÂÖ± ${totalRecords} Êù°ËÆ∞ÂΩï`;
            container.appendChild(paginationInfo);

            // Pagination controls
            const controlsContainer = document.createElement('div');
            controlsContainer.className = 'pagination-controls';

            // Previous button
            const prevBtn = document.createElement('button');
            prevBtn.className = 'pagination-btn';
            prevBtn.textContent = '‰∏ä‰∏ÄÈ°µ';
            prevBtn.disabled = currentPage <= 1;
            prevBtn.onclick = () => {
                if (currentPage > 1) {
                    loadFoldersAndDocuments(currentPage - 1);
                }
            };
            controlsContainer.appendChild(prevBtn);

            // Page numbers with ellipsis
            const pageNumbers = generatePageNumbers(currentPage, totalPages);

            pageNumbers.forEach((item, index) => {
                if (item === '...') {
                    const ellipsis = document.createElement('span');
                    ellipsis.className = 'pagination-ellipsis';
                    ellipsis.textContent = '...';
                    controlsContainer.appendChild(ellipsis);
                } else {
                    const pageBtn = document.createElement('button');
                    pageBtn.className = 'pagination-btn';
                    if (item === currentPage) {
                        pageBtn.classList.add('active');
                    }
                    pageBtn.textContent = item;
                    pageBtn.onclick = () => {
                        if (item !== currentPage) {
                            loadFoldersAndDocuments(item);
                        }
                    };
                    controlsContainer.appendChild(pageBtn);
                }
            });

            // Next button
            const nextBtn = document.createElement('button');
            nextBtn.className = 'pagination-btn';
            nextBtn.textContent = '‰∏ã‰∏ÄÈ°µ';
            nextBtn.disabled = currentPage >= totalPages;
            nextBtn.onclick = () => {
                if (currentPage < totalPages) {
                    loadFoldersAndDocuments(currentPage + 1);
                }
            };
            controlsContainer.appendChild(nextBtn);

            container.appendChild(controlsContainer);

            // Page jump input
            const pageJump = document.createElement('div');
            pageJump.className = 'page-jump';

            const jumpLabel = document.createElement('span');
            jumpLabel.textContent = 'Ë∑≥ËΩ¨Âà∞';
            jumpLabel.style.fontSize = '14px';
            jumpLabel.style.color = 'var(--text-secondary)';
            pageJump.appendChild(jumpLabel);

            const jumpInput = document.createElement('input');
            jumpInput.type = 'number';
            jumpInput.min = '1';
            jumpInput.max = totalPages;
            jumpInput.value = currentPage;
            jumpInput.id = 'pageJumpInput';
            pageJump.appendChild(jumpInput);

            const jumpBtn = document.createElement('button');
            jumpBtn.textContent = 'ÂâçÂæÄ';
            jumpBtn.onclick = () => {
                const targetPage = parseInt(jumpInput.value);
                if (targetPage >= 1 && targetPage <= totalPages && targetPage !== currentPage) {
                    loadFoldersAndDocuments(targetPage);
                }
            };
            pageJump.appendChild(jumpBtn);

            container.appendChild(pageJump);
        }

        function generatePageNumbers(current, total) {
            const pages = [];
            const delta = 2; // Number of pages to show around current page

            // Show first page
            if (total > 0) {
                pages.push(1);
            }

            // Show ellipsis after first page if needed
            if (current - delta > 2) {
                pages.push('...');
            }

            // Show pages around current page
            for (let i = Math.max(2, current - delta); i <= Math.min(total - 1, current + delta); i++) {
                pages.push(i);
            }

            // Show ellipsis before last page if needed
            if (current + delta < total - 1) {
                pages.push('...');
            }

            // Show last page if different from first page
            if (total > 1) {
                pages.push(total);
            }

            // Remove duplicates
            return [...new Set(pages)];
        }

        /**
         * Ëé∑ÂèñÊñáÊ°£ÊâÄÂú®Êñá‰ª∂Â§πÂêçÁß∞
         */
        function getDocumentFolderName(folderId) {
            if (!folderId) {
                return 'Êú™ÂàÜÁ±ª';
            }
            const folder = folders.find(f => f.id === folderId);
            return folder ? folder.name : 'Êú™Áü•Êñá‰ª∂Â§π';
        }

        // ================== Êñá‰ª∂Â§πÂäüËÉΩÂáΩÊï∞ ==================

        
        /**
         * Â∞ÜÊñá‰ª∂Â§πÊ†ëÂΩ¢ÁªìÊûÑÊâÅÂπ≥Âåñ
         */
        function flattenFolderTree(tree) {
            const result = [];

            function flatten(nodes) {
                nodes.forEach(node => {
                    result.push(node);
                    if (node.children && node.children.length > 0) {
                        flatten(node.children);
                    }
                });
            }

            flatten(tree);
            return result;
        }




        /**
         * ÂàùÂßãÂåñÊñá‰ª∂Â§πÁõ∏ÂÖ≥‰∫ã‰ª∂ÁõëÂê¨Âô®
         */
        function initFolderEventListeners() {
            // Êñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            initFolderModalEvents();

            // ÁßªÂä®ÊñáÊ°£/Êñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            initMoveDocumentModalEvents();

            // ÈáçÂëΩÂêçÊñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
            initRenameFolderModalEvents();
        }

        /**
         * ÊòæÁ§∫Êñ∞Âª∫Êñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü
         */
        function showCreateFolderModal() {
            const modal = document.getElementById('folderModal');
            const title = document.getElementById('folderModalTitle');
            const form = document.getElementById('folderForm');
            const nameInput = document.getElementById('folderName');
            const descInput = document.getElementById('folderDescription');
            const parentSelect = document.getElementById('folderParent');

            // ÈáçÁΩÆË°®Âçï
            form.reset();
            title.textContent = 'Êñ∞Âª∫Êñá‰ª∂Â§π';

            // Â°´ÂÖÖÁà∂Êñá‰ª∂Â§πÈÄâÈ°π
            parentSelect.innerHTML = '<option value="">Ê†πÁõÆÂΩï</option>';
            folderTree.forEach(folder => {
                addFolderToSelect(folder, parentSelect, 0);
            });

            modal.classList.add('show');
        }

        /**
         * ÈÄíÂΩíÊ∑ªÂä†Êñá‰ª∂Â§πÂà∞ÈÄâÊã©Ê°Ü
         */
        function addFolderToSelect(folder, select, level = 0) {
            const option = document.createElement('option');
            option.value = folder.id;
            option.textContent = '  '.repeat(level) + folder.name;
            select.appendChild(option);

            if (folder.children && folder.children.length > 0) {
                folder.children.forEach(child => {
                    addFolderToSelect(child, select, level + 1);
                });
            }
        }

        /**
         * ÂàùÂßãÂåñÊñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
         */
        function initFolderModalEvents() {
            const modal = document.getElementById('folderModal');
            const closeBtn = document.getElementById('folderModalClose');
            const cancelBtn = document.getElementById('folderModalCancel');
            const saveBtn = document.getElementById('folderModalSave');

            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            }

            if (saveBtn) {
                saveBtn.addEventListener('click', saveFolder);
            }

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        }

        /**
         * ‰øùÂ≠òÊñá‰ª∂Â§π
         */
        async function saveFolder() {
            const nameInput = document.getElementById('folderName');
            const descInput = document.getElementById('folderDescription');
            const parentSelect = document.getElementById('folderParent');

            const name = nameInput.value.trim();
            if (!name) {
                alert('ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞');
                return;
            }

            try {
                const response = await fetch('/api/folders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        name: name,
                        description: descInput.value.trim() || null,
                        parent_id: parentSelect.value || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('folderModal').classList.remove('show');
                    loadFoldersAndDocuments(); // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                } else {
                    alert(`ÂàõÂª∫Êñá‰ª∂Â§πÂ§±Ë¥•: ${data.error}`);
                }
            } catch (error) {
                console.error('Error creating folder:', error);
                alert('ÂàõÂª∫Êñá‰ª∂Â§πÊó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
            }
        }

        /**
         * ÊòæÁ§∫ÁßªÂä®ÊñáÊ°£Ê®°ÊÄÅÊ°Ü
         */
        // Enhanced Move Document Modal with Search and Keyboard Navigation
        let folderTreeData = [];
        let filteredFolderTree = [];
        let currentKeyboardIndex = -1;
        let searchTerm = '';

        async function showMoveDocumentModal(documentId) {
            const modal = document.getElementById('moveDocumentModal');
            const folderList = document.getElementById('moveFolderList');
            const searchInput = document.getElementById('folderSearchInput');
            const breadcrumb = document.getElementById('folderBreadcrumb');

            // Reset state
            folderTreeData = [];
            filteredFolderTree = [];
            currentKeyboardIndex = -1;
            searchTerm = '';
            searchInput.value = '';
            document.getElementById('searchClearBtn').style.display = 'none';

            // Show loading state
            folderList.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂Â§πÂàóË°®...</p>
                </div>
            `;

            // Save current document ID
            modal.dataset.documentId = documentId;
            modal.dataset.folderId = ''; // Reset folder ID for document move
            modal.classList.add('show');

            // Reset breadcrumb to show root
            updateBreadcrumb([]);

            // Focus search input after modal opens
            setTimeout(() => searchInput.focus(), 100);

            try {
                const foldersResponse = await fetch('/api/folders/tree', {
                    credentials: 'include'
                });

                const foldersData = await foldersResponse.json();

                if (foldersResponse.ok) {
                    folderTreeData = foldersData.tree || [];
                    filteredFolderTree = [...folderTreeData];
                    renderFolderList();
                    initSearchListeners();
                    initKeyboardNavigation();
                    initCreateFolderButton();
                } else {
                    throw new Error(foldersData.error || 'Ëé∑ÂèñÊñá‰ª∂Â§πÂàóË°®Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Error loading folders for move modal:', error);
                folderList.innerHTML = `
                    <div class="error-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <h3>Âä†ËΩΩÂ§±Ë¥•</h3>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary btn-sm" onclick="location.reload()">ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢</button>
                    </div>
                `;
            }
        }

        /**
         * Render folder list with enhanced UI
         */
        function renderFolderList() {
            const folderList = document.getElementById('moveFolderList');

            if (filteredFolderTree.length === 0 && folderTreeData.length === 0) {
                // No folders at all
                folderList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h3>ÊöÇÊó†Êñá‰ª∂Â§π</h3>
                        <p>ÊÇ®ÂèØ‰ª•ÂàõÂª∫Êñ∞Êñá‰ª∂Â§πÊàñÁõ¥Êé•Â∞ÜÊñáÊ°£ÁßªÂä®Âà∞Ê†πÁõÆÂΩï</p>
                    </div>
                `;
                return;
            }

            if (filteredFolderTree.length === 0 && searchTerm) {
                // Search returned no results
                folderList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="11" cy="11" r="8"></circle>
                            <path d="m21 21-4.35-4.35"></path>
                        </svg>
                        <h3>Êú™ÊâæÂà∞ÂåπÈÖçÁöÑÊñá‰ª∂Â§π</h3>
                        <p>Â∞ùËØï‰ΩøÁî®ÂÖ∂‰ªñÂÖ≥ÈîÆËØçÊêúÁ¥¢</p>
                    </div>
                `;
                return;
            }

            folderList.innerHTML = '';

            // Add root directory option
            const rootOption = createFolderOption({
                id: '',
                name: 'Ê†πÁõÆÂΩï',
                document_count: getRootDocumentCount(),
                is_root: true
            }, 0);
            folderList.appendChild(rootOption);

            // Add folder options
            filteredFolderTree.forEach(folder => {
                const folderElement = createFolderElement(folder, 0);
                folderList.appendChild(folderElement);
            });
        }

        /**
         * Create folder element with proper nesting
         */
        function createFolderElement(folder, level, excludeFolderId = null) {
            if (excludeFolderId && folder.id === excludeFolderId) {
                return document.createDocumentFragment(); // Return empty fragment
            }

            const container = document.createDocumentFragment();
            const option = createFolderOption(folder, level);
            container.appendChild(option);

            if (folder.children && folder.children.length > 0) {
                folder.children.forEach(child => {
                    const childElement = createFolderElement(child, level + 1, excludeFolderId);
                    container.appendChild(childElement);
                });
            }

            return container;
        }

        /**
         * Create individual folder option element
         */
        function createFolderOption(folder, level) {
            const option = document.createElement('div');
            option.className = `folder-option ${level > 0 ? 'child' : ''}`;
            option.dataset.folderId = folder.id;
            option.dataset.keyboardIndex = 'root'; // Special index for root

            const isRoot = folder.is_root;
            const indent = level > 0 ? `<div class="folder-indent" style="width: ${level * 20}px;"></div>` : '';

            option.innerHTML = `
                ${indent}
                <svg class="folder-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    ${isRoot ?
                        `<path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                         <polyline points="9 22 9 12 15 12 15 22"></polyline>` :
                        `<path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>`
                    }
                </svg>
                <div class="folder-content">
                    <span class="folder-name">${folder.name}</span>
                    ${folder.document_count > 0 ? `<span class="folder-count">${folder.document_count}</span>` : ''}
                </div>
            `;

            option.addEventListener('click', () => selectMoveFolder(folder.id));
            option.addEventListener('dblclick', () => {
                selectMoveFolder(folder.id);
                confirmMove();
            });

            return option;
        }

        /**
         * Get document count for root directory
         */
        function getRootDocumentCount() {
            // This would need to be calculated from documents without folder_id
            // For now, return 0 - could be enhanced with actual API call
            return 0;
        }

        /**
         * Select folder with enhanced UI feedback
         */
        function selectMoveFolder(folderId) {
            // Remove all selection states
            document.querySelectorAll('#moveFolderList .folder-option').forEach(option => {
                option.classList.remove('selected');
            });

            // Add selection to chosen folder
            const selectedOption = document.querySelector(`#moveFolderList .folder-option[data-folder-id="${folderId}"]`);
            if (selectedOption) {
                selectedOption.classList.add('selected');

                // Update modal data
                const modal = document.getElementById('moveDocumentModal');
                if (modal) {
                    modal.dataset.selectedFolderId = folderId;
                }

                // Update selected info display
                updateSelectedInfo(folderId);

                // Enable confirm button
                const confirmBtn = document.getElementById('moveModalConfirm');
                if (confirmBtn) {
                    confirmBtn.disabled = false;
                }

                // Update keyboard index
                updateKeyboardIndex(selectedOption);
            }
        }

        /**
         * Update selected folder info display
         */
        function updateSelectedInfo(folderId) {
            const selectedInfo = document.getElementById('selectedFolderInfo');
            const selectedName = document.getElementById('selectedFolderName');

            if (folderId === '') {
                selectedName.textContent = 'Ê†πÁõÆÂΩï';
            } else {
                const folder = findFolderById(folderId, folderTreeData);
                selectedName.textContent = folder ? folder.name : '';
            }

            selectedInfo.style.display = 'flex';
        }

        /**
         * Find folder by ID in tree structure
         */
        function findFolderById(id, folders) {
            for (const folder of folders) {
                if (folder.id === id) {
                    return folder;
                }
                if (folder.children) {
                    const found = findFolderById(id, folder.children);
                    if (found) return found;
                }
            }
            return null;
        }

        /**
         * Search functionality with real-time filtering
         */
        function initSearchListeners() {
            const searchInput = document.getElementById('folderSearchInput');
            const clearBtn = document.getElementById('searchClearBtn');

            searchInput.addEventListener('input', (e) => {
                searchTerm = e.target.value.trim();
                filterFolders();

                // Show/hide clear button
                clearBtn.style.display = searchTerm ? 'flex' : 'none';
            });

            clearBtn.addEventListener('click', () => {
                searchInput.value = '';
                searchTerm = '';
                filterFolders();
                clearBtn.style.display = 'none';
                searchInput.focus();
            });
        }

        /**
         * Filter folders based on search term
         */
        function filterFolders() {
            if (!searchTerm) {
                filteredFolderTree = [...folderTreeData];
            } else {
                filteredFolderTree = filterFolderTree(folderTreeData, searchTerm.toLowerCase());
            }
            renderFolderList();
            updateKeyboardNavigation();
        }

        /**
         * Recursively filter folder tree
         */
        function filterFolderTree(folders, term) {
            const filtered = [];

            for (const folder of folders) {
                const matchesName = folder.name.toLowerCase().includes(term);
                const filteredChildren = folder.children ?
                    filterFolderTree(folder.children, term) : [];

                if (matchesName || filteredChildren.length > 0) {
                    filtered.push({
                        ...folder,
                        children: filteredChildren
                    });
                }
            }

            return filtered;
        }

        /**
         * Keyboard navigation support
         */
        function initKeyboardNavigation() {
            const modal = document.getElementById('moveDocumentModal');

            modal.addEventListener('keydown', handleKeyboardNavigation);
        }

        function handleKeyboardNavigation(e) {
            const folderOptions = Array.from(document.querySelectorAll('#moveFolderList .folder-option'));

            switch (e.key) {
                case 'ArrowDown':
                    e.preventDefault();
                    navigateKeyboard(1, folderOptions);
                    break;
                case 'ArrowUp':
                    e.preventDefault();
                    navigateKeyboard(-1, folderOptions);
                    break;
                case 'Enter':
                    e.preventDefault();
                    confirmMove();
                    break;
                case 'Escape':
                    e.preventDefault();
                    closeModal();
                    break;
            }
        }

        function navigateKeyboard(direction, folderOptions) {
            if (folderOptions.length === 0) return;

            // Remove current keyboard focus
            if (currentKeyboardIndex >= 0) {
                folderOptions[currentKeyboardIndex]?.classList.remove('keyboard-focus');
            }

            // Calculate new index
            currentKeyboardIndex += direction;
            if (currentKeyboardIndex < 0) {
                currentKeyboardIndex = folderOptions.length - 1;
            } else if (currentKeyboardIndex >= folderOptions.length) {
                currentKeyboardIndex = 0;
            }

            // Apply keyboard focus
            const newOption = folderOptions[currentKeyboardIndex];
            newOption.classList.add('keyboard-focus');
            newOption.scrollIntoView({ block: 'nearest' });

            // Auto-select the focused folder
            const folderId = newOption.dataset.folderId;
            selectMoveFolder(folderId);
        }

        function updateKeyboardIndex(selectedOption) {
            const folderOptions = Array.from(document.querySelectorAll('#moveFolderList .folder-option'));
            currentKeyboardIndex = folderOptions.indexOf(selectedOption);
        }

        function updateKeyboardNavigation() {
            currentKeyboardIndex = -1;
            const folderOptions = document.querySelectorAll('#moveFolderList .folder-option');
            folderOptions.forEach(option => option.classList.remove('keyboard-focus'));
        }

        /**
         * Update breadcrumb navigation
         */
        function updateBreadcrumb(path) {
            const breadcrumb = document.getElementById('folderBreadcrumb');
            breadcrumb.innerHTML = '';

            const rootItem = document.createElement('div');
            rootItem.className = 'breadcrumb-item active';
            rootItem.innerHTML = `
                <svg class="breadcrumb-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                    <path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"></path>
                    <polyline points="9 22 9 12 15 12 15 22"></polyline>
                </svg>
                <span>Ê†πÁõÆÂΩï</span>
            `;
            breadcrumb.appendChild(rootItem);

            path.forEach((folder, index) => {
                const separator = document.createElement('span');
                separator.textContent = '/';
                separator.style.color = 'var(--text-secondary)';
                breadcrumb.appendChild(separator);

                const item = document.createElement('div');
                item.className = 'breadcrumb-item';
                item.innerHTML = `
                    <svg class="breadcrumb-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor">
                        <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                    </svg>
                    <span>${folder.name}</span>
                `;
                breadcrumb.appendChild(item);
            });
        }

        /**
         * Create new folder functionality
         */
        function initCreateFolderButton() {
            const createBtn = document.getElementById('createNewFolderBtn');
            createBtn.addEventListener('click', showCreateFolderDialog);
        }

        function showCreateFolderDialog() {
            const folderName = prompt('ËØ∑ËæìÂÖ•Êñ∞Êñá‰ª∂Â§πÂêçÁß∞:');
            if (!folderName || folderName.trim() === '') {
                return;
            }

            createNewFolder(folderName.trim());
        }

        async function createNewFolder(name) {
            try {
                const response = await fetch('/api/folders', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        name: name,
                        description: '',
                        parent_id: null // Create at root for now
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // Refresh folder tree
                    const foldersResponse = await fetch('/api/folders/tree', {
                        credentials: 'include'
                    });

                    const foldersData = await foldersResponse.json();
                    if (foldersResponse.ok) {
                        folderTreeData = foldersData.tree || [];
                        filteredFolderTree = [...folderTreeData];
                        renderFolderList();

                        // Auto-select the newly created folder
                        selectMoveFolder(data.id);
                    }
                } else {
                    alert(`ÂàõÂª∫Êñá‰ª∂Â§πÂ§±Ë¥•: ${data.error}`);
                }
            } catch (error) {
                console.error('Error creating folder:', error);
                alert('ÂàõÂª∫Êñá‰ª∂Â§πÊó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
            }
        }

        /**
         * Confirm move operation
         */
        function confirmMove() {
            const modal = document.getElementById('moveDocumentModal');
            const documentId = modal.dataset.documentId;
            const folderId = modal.dataset.selectedFolderId || '';

            if (documentId) {
                moveDocumentToFolder(documentId, folderId);
            } else if (modal.dataset.folderId) {
                moveFolderToFolder(modal.dataset.folderId, folderId);
            }
        }

        /**
         * Close modal with cleanup
         */
        function closeModal() {
            const modal = document.getElementById('moveDocumentModal');
            modal.classList.remove('show');
            clearMoveModalState();
        }

        /**
         * Enhanced move document to folder function
         */
        async function moveDocumentToFolder(documentId, folderId) {
            try {
                const confirmBtn = document.getElementById('moveModalConfirm');
                confirmBtn.disabled = true;
                confirmBtn.innerHTML = `
                    <div style="width: 16px; height: 16px; border: 2px solid transparent; border-top: 2px solid currentColor; border-radius: 50%; animation: spin 0.8s linear infinite; margin-right: 6px;"></div>
                    ÁßªÂä®‰∏≠...
                `;

                const response = await fetch(`/api/documents/${documentId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        folder_id: folderId || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    closeModal();
                    loadFoldersAndDocuments(currentPage);
                } else {
                    throw new Error(data.error || 'ÁßªÂä®ÊñáÊ°£Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Error moving document:', error);
                alert(`ÁßªÂä®ÊñáÊ°£Â§±Ë¥•: ${error.message}`);
            } finally {
                // Reset button
                const confirmBtn = document.getElementById('moveModalConfirm');
                confirmBtn.disabled = false;
                confirmBtn.innerHTML = `
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 6px;">
                        <polyline points="20 6 9 17 4 12"></polyline>
                    </svg>
                    ÁßªÂä®
                `;
            }
        }

        async function moveFolderToFolder(folderId, targetParentId) {
            try {
                const response = await fetch(`/api/folders/${folderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        parent_id: targetParentId || null
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    document.getElementById('moveDocumentModal').classList.remove('show');
                    loadFoldersAndDocuments(currentPage); // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                } else {
                    alert(`ÁßªÂä®Êñá‰ª∂Â§πÂ§±Ë¥•: ${data.error}`);
                }
            } catch (error) {
                console.error('Error moving folder:', error);
                alert('ÁßªÂä®Êñá‰ª∂Â§πÊó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
            }
        }

        /**
         * ÂàùÂßãÂåñÁßªÂä®ÊñáÊ°£Ê®°ÊÄÅÊ°Ü‰∫ã‰ª∂
         */
        function initMoveDocumentModalEvents() {
            const modal = document.getElementById('moveDocumentModal');
            const closeBtn = document.getElementById('moveModalClose');
            const cancelBtn = document.getElementById('moveModalCancel');
            const confirmBtn = document.getElementById('moveModalConfirm');

            if (closeBtn) {
                closeBtn.addEventListener('click', closeModal);
            }

            if (cancelBtn) {
                cancelBtn.addEventListener('click', closeModal);
            }

            if (confirmBtn) {
                confirmBtn.addEventListener('click', confirmMove);
            }

            // Click outside to close
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    closeModal();
                }
            });
        }

        /**
         * Ê∏ÖÈô§ÁßªÂä®Ê®°ÊÄÅÊ°ÜÁöÑÁä∂ÊÄÅ
         */
        function clearMoveModalState() {
            const modal = document.getElementById('moveDocumentModal');
            if (modal) {
                // Clear modal data
                delete modal.dataset.documentId;
                delete modal.dataset.folderId;
                delete modal.dataset.selectedFolderId;

                // Clear selections
                document.querySelectorAll('#moveFolderList .folder-option').forEach(option => {
                    option.classList.remove('selected', 'keyboard-focus');
                });

                // Reset UI elements
                const confirmBtn = document.getElementById('moveModalConfirm');
                if (confirmBtn) {
                    confirmBtn.disabled = true;
                    confirmBtn.innerHTML = `
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" style="width: 16px; height: 16px; margin-right: 6px;">
                            <polyline points="20 6 9 17 4 12"></polyline>
                        </svg>
                        ÁßªÂä®
                    `;
                }

                // Hide selected info
                const selectedInfo = document.getElementById('selectedFolderInfo');
                if (selectedInfo) {
                    selectedInfo.style.display = 'none';
                }

                // Reset search
                const searchInput = document.getElementById('folderSearchInput');
                const clearBtn = document.getElementById('searchClearBtn');
                if (searchInput) {
                    searchInput.value = '';
                }
                if (clearBtn) {
                    clearBtn.style.display = 'none';
                }

                // Reset global state
                folderTreeData = [];
                filteredFolderTree = [];
                currentKeyboardIndex = -1;
                searchTerm = '';

                // Reset modal title
                const modalTitle = modal.querySelector('.modal-title');
                if (modalTitle) {
                    modalTitle.textContent = 'ÁßªÂä®ÊñáÊ°£';
                }
            }
        }

        /**
         * Enhanced move folder modal (for moving folders)
         */
        async function showMoveFolderModal(folderId) {
            const modal = document.getElementById('moveDocumentModal');
            const folderList = document.getElementById('moveFolderList');
            const searchInput = document.getElementById('folderSearchInput');

            // Reset state
            folderTreeData = [];
            filteredFolderTree = [];
            currentKeyboardIndex = -1;
            searchTerm = '';
            searchInput.value = '';
            document.getElementById('searchClearBtn').style.display = 'none';

            // Update modal title
            const modalTitle = modal.querySelector('.modal-title');
            modalTitle.textContent = 'ÁßªÂä®Êñá‰ª∂Â§π';

            // Show loading state
            folderList.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂Â§πÂàóË°®...</p>
                </div>
            `;

            // Save current folder ID
            modal.dataset.documentId = ''; // No document
            modal.dataset.folderId = folderId;
            modal.classList.add('show');

            // Reset breadcrumb
            updateBreadcrumb([]);

            // Focus search input after modal opens
            setTimeout(() => searchInput.focus(), 100);

            try {
                const foldersResponse = await fetch('/api/folders/tree', {
                    credentials: 'include'
                });

                const foldersData = await foldersResponse.json();

                if (foldersResponse.ok) {
                    folderTreeData = foldersData.tree || [];
                    filteredFolderTree = [...folderTreeData];
                    renderFolderListWithExclusion(folderId);
                    initSearchListeners();
                    initKeyboardNavigation();
                    initCreateFolderButton();
                } else {
                    throw new Error(foldersData.error || 'Ëé∑ÂèñÊñá‰ª∂Â§πÂàóË°®Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Error loading folders for move modal:', error);
                folderList.innerHTML = `
                    <div class="error-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <circle cx="12" cy="12" r="10"></circle>
                            <line x1="12" y1="8" x2="12" y2="12"></line>
                            <line x1="12" y1="16" x2="12.01" y2="16"></line>
                        </svg>
                        <h3>Âä†ËΩΩÂ§±Ë¥•</h3>
                        <p>${error.message}</p>
                        <button class="btn btn-secondary btn-sm" onclick="location.reload()">ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢</button>
                    </div>
                `;
            }
        }

        /**
         * Render folder list with exclusion for folder moving
         */
        function renderFolderListWithExclusion(excludeFolderId) {
            const folderList = document.getElementById('moveFolderList');

            if (filteredFolderTree.length === 0 && folderTreeData.length === 0) {
                folderList.innerHTML = `
                    <div class="empty-state">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor">
                            <path d="M22 19a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h5l2 3h9a2 2 0 0 1 2 2z"></path>
                        </svg>
                        <h3>ÊöÇÊó†ÂèØÁî®Êñá‰ª∂Â§π</h3>
                        <p>ÂèØ‰ª•ÂàõÂª∫Êñ∞Êñá‰ª∂Â§πÊàñÂ∞ÜÂΩìÂâçÊñá‰ª∂Â§πÁßªÂä®Âà∞Ê†πÁõÆÂΩï</p>
                    </div>
                `;
                return;
            }

            folderList.innerHTML = '';

            // Add root directory option
            const rootOption = createFolderOption({
                id: '',
                name: 'Ê†πÁõÆÂΩï',
                document_count: getRootDocumentCount(),
                is_root: true
            }, 0);
            folderList.appendChild(rootOption);

            // Add folder options with exclusion
            filteredFolderTree.forEach(folder => {
                const folderElement = createFolderElement(folder, 0, excludeFolderId);
                folderList.appendChild(folderElement);
            });
        }

        function renderBreadcrumb() {
            const breadcrumbContainer = document.getElementById('breadcrumb');
            breadcrumbContainer.innerHTML = '';

            // Always show root as first item
            const rootItem = document.createElement('a');
            rootItem.href = '#';
            rootItem.className = 'breadcrumb-item';
            rootItem.innerHTML = 'üè† ÊàëÁöÑÊñáÊ°£';
            rootItem.onclick = (e) => {
                e.preventDefault();
                backToAllDocuments();
            };

            if (!currentFolderId) {
                rootItem.classList.add('active');
            }

            breadcrumbContainer.appendChild(rootItem);

            // Build path for current folder
            if (currentFolderId) {
                const path = buildFolderPath(currentFolderId);
                path.forEach((folder, index) => {
                    // Add separator
                    const separator = document.createElement('span');
                    separator.className = 'breadcrumb-separator';
                    separator.textContent = '‚Ä∫';
                    breadcrumbContainer.appendChild(separator);

                    // Add folder item
                    const folderItem = document.createElement('a');
                    folderItem.href = '#';
                    folderItem.className = 'breadcrumb-item';
                    folderItem.innerHTML = `üìÅ ${escapeHtml(folder.name)}`;

                    if (index === path.length - 1) {
                        // Current folder - make it active
                        folderItem.classList.add('active');
                        folderItem.onclick = (e) => e.preventDefault();
                    } else {
                        // Parent folder - make it clickable
                        folderItem.onclick = (e) => {
                            e.preventDefault();
                            openFolder(folder.id);
                        };
                    }

                    breadcrumbContainer.appendChild(folderItem);
                });
            }
        }

        function buildFolderPath(folderId) {
            const path = [];
            let currentFolder = folders.find(f => f.id === folderId);

            while (currentFolder) {
                path.unshift(currentFolder);
                if (currentFolder.parent_id) {
                    currentFolder = folders.find(f => f.id === currentFolder.parent_id);
                } else {
                    break;
                }
            }

            return path;
        }

        function backToAllDocuments() {
            currentFolderId = null;
            currentPage = 1;
            loadFoldersAndDocuments(1);

            // Reset page title and subtitle
            const pageTitle = document.querySelector('.page-title');
            const pageSubtitle = document.querySelector('.page-subtitle');
            pageTitle.textContent = 'ÊàëÁöÑÊñáÊ°£';
            pageSubtitle.textContent = 'ÁÆ°ÁêÜÊÇ®ÁöÑÊâÄÊúâÊñáÊ°£ÂÜÖÂÆπÔºåÊîØÊåÅ Markdown ÁºñËæëÂíåÈ¢ÑËßà';
        }

        function openFolder(folderId) {
            // Show documents in this folder by updating the page state
            currentFolderId = folderId;
            currentPage = 1;
            loadFoldersAndDocuments(1);

            // Update the page title to reflect the current folder
            const folder = folders.find(f => f.id === folderId);
            const pageTitle = document.querySelector('.page-title');
            const pageSubtitle = document.querySelector('.page-subtitle');

            if (folder) {
                pageTitle.textContent = folder.name;
                pageSubtitle.textContent = `Êü•ÁúãÊñá‰ª∂Â§π "${folder.name}" ‰∏≠ÁöÑÊñáÊ°£`;
            } else {
                pageTitle.textContent = 'ÊàëÁöÑÊñáÊ°£';
                pageSubtitle.textContent = 'ÁÆ°ÁêÜÊÇ®ÁöÑÊâÄÊúâÊñáÊ°£ÂÜÖÂÆπÔºåÊîØÊåÅ Markdown ÁºñËæëÂíåÈ¢ÑËßà';
            }
        }

        function editDocument(id) {
            window.location.href = `/editor/?id=${id}`;
        }

        function viewDocument(id, title) {
            // Open document in modal instead of new window
            fetch(`/api/documents/${id}`, {
                credentials: 'include'
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Failed to load document');
                }
                return response.json();
            })
            .then(doc => {
                const modal = document.getElementById('documentModal');
                const titleElement = document.getElementById('documentViewerTitle');
                const contentElement = document.getElementById('documentViewerContent');

                titleElement.textContent = title;
                contentElement.innerHTML = parseMarkdown(doc.content);

                modal.classList.add('show');
            })
            .catch(error => {
                console.error('Error loading document:', error);
                alert('Âä†ËΩΩÊñáÊ°£Êó∂Âá∫Èîô');
            });
        }

        async function deleteDocument(id, title) {
            if (confirm(`Á°ÆÂÆöË¶ÅÂà†Èô§ "${title}" ÂêóÔºü`)) {
                try {
                    const response = await fetch(`/api/documents/${id}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        // Reload documents, stay on current page
                        loadFoldersAndDocuments(currentPage);
                    } else {
                        const data = await response.json();
                        alert(`Âà†Èô§ÊñáÊ°£ÈîôËØØ: ${data.error}`);
                    }
                } catch (error) {
                    console.error('Error deleting document:', error);
                    alert('Âà†Èô§ÊñáÊ°£Êó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
                }
            }
        }

        async function showMoveFolderModal(folderId) {
            const modal = document.getElementById('moveDocumentModal');
            const folderList = document.getElementById('moveFolderList');
            const modalTitle = modal.querySelector('.modal-title');

            modalTitle.textContent = 'ÁßªÂä®Êñá‰ª∂Â§π';

            // ÊòæÁ§∫Âä†ËΩΩÁä∂ÊÄÅ
            folderList.innerHTML = '<div class="loading-message">Ê≠£Âú®Âä†ËΩΩÊñá‰ª∂Â§πÂàóË°®...</div>';

            modal.dataset.folderId = folderId;
            modal.classList.add('show');

            try {
                // ÈáçÊñ∞Ëé∑ÂèñÊúÄÊñ∞ÁöÑÊñá‰ª∂Â§πÂàóË°®
                const foldersResponse = await fetch('/api/folders/tree', {
                    credentials: 'include'
                });

                const foldersData = await foldersResponse.json();

                if (foldersResponse.ok) {
                    const currentFolderTree = foldersData.tree || [];

                    // Â°´ÂÖÖÊñá‰ª∂Â§πÈÄâÈ°π
                    folderList.innerHTML = '';

                    // Add "Move to root" option
                    const moveToRoot = document.createElement('div');
                    moveToRoot.className = 'folder-option';
                    moveToRoot.dataset.folderId = '';
                    moveToRoot.innerHTML = `
                        <span class="folder-icon">üìÅ</span>
                        <span>ÁßªÂä®Âà∞Ê†πÁõÆÂΩï</span>
                    `;
                    moveToRoot.onclick = () => selectMoveFolder('');
                    folderList.appendChild(moveToRoot);

                    // Add folder options (exclude current folder and its descendants)
                    if (currentFolderTree.length > 0) {
                        currentFolderTree.forEach(folder => {
                            if (folder.id !== folderId && !isDescendant(folderId, folder)) {
                                const folderElement = createFolderElement(folder, 0, folderId);
                                folderList.appendChild(folderElement);
                            }
                        });
                    } else {
                        // Â¶ÇÊûúÊ≤°ÊúâÂÖ∂‰ªñÊñá‰ª∂Â§πÔºåÊòæÁ§∫ÊèêÁ§∫‰ø°ÊÅØ
                        const noFolders = document.createElement('div');
                        noFolders.className = 'loading-message';
                        noFolders.innerHTML = `
                            <div style="font-size: 24px; margin-bottom: 8px;">üìÇ</div>
                            <div>Ê†πÁõÆÂΩïÊòØÂîØ‰∏ÄÂèØÁßªÂä®ÁöÑ‰ΩçÁΩÆ</div>
                        `;
                        folderList.appendChild(noFolders);
                    }
                } else {
                    throw new Error(foldersData.error || 'Ëé∑ÂèñÊñá‰ª∂Â§πÂàóË°®Â§±Ë¥•');
                }
            } catch (error) {
                console.error('Error loading folders for move modal:', error);
                folderList.innerHTML = `
                    <div class="error-message">
                        <div style="font-size: 24px; margin-bottom: 8px;">‚ö†Ô∏è</div>
                        <div style="margin-bottom: 12px;">Âä†ËΩΩÊñá‰ª∂Â§πÂàóË°®Â§±Ë¥•: ${error.message}</div>
                        <button class="btn btn-secondary btn-sm" onclick="location.reload()">ÈáçÊñ∞Âä†ËΩΩÈ°µÈù¢</button>
                    </div>
                `;
            }
        }

        function isDescendant(targetFolderId, folder) {
            if (folder.id === targetFolderId) return true;
            if (folder.children && folder.children.length > 0) {
                return folder.children.some(child => isDescendant(targetFolderId, child));
            }
            return false;
        }

        async function deleteFolder(id, title) {
            const folder = folders.find(f => f.id === id);
            const documentCount = folder?.document_count || 0;

            let confirmMessage = `Á°ÆÂÆöË¶ÅÂà†Èô§Êñá‰ª∂Â§π "${title}" ÂêóÔºü`;
            if (documentCount > 0) {
                confirmMessage += `\n\nÊ≥®ÊÑèÔºöÊñá‰ª∂Â§π‰∏≠Êúâ ${documentCount} ‰∏™ÊñáÊ°£ÔºåÂà†Èô§Êñá‰ª∂Â§πÂ∞ÜÂêåÊó∂Âà†Èô§ÂÖ∂‰∏≠ÁöÑÊâÄÊúâÊñáÊ°£„ÄÇ`;
            }

            if (confirm(confirmMessage)) {
                try {
                    const response = await fetch(`/api/folders/${id}`, {
                        method: 'DELETE',
                        credentials: 'include'
                    });

                    if (response.ok) {
                        loadFoldersAndDocuments(currentPage);
                    } else {
                        const data = await response.json();
                        alert(`Âà†Èô§Êñá‰ª∂Â§πÈîôËØØ: ${data.error}`);
                    }
                } catch (error) {
                    console.error('Error deleting folder:', error);
                    alert('Âà†Èô§Êñá‰ª∂Â§πÊó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
                }
            }
        }

        /**
         * ÊòæÁ§∫ÈáçÂëΩÂêçÊñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü
         */
        function showRenameFolderModal(folderId) {
            const modal = document.getElementById('renameFolderModal');
            const nameInput = document.getElementById('renameFolderName');
            const descriptionInput = document.getElementById('renameFolderDescription');

            // Ëé∑ÂèñÊñá‰ª∂Â§π‰ø°ÊÅØ
            const folder = folders.find(f => f.id === folderId);
            if (!folder) {
                alert('Êâæ‰∏çÂà∞ÊåáÂÆöÁöÑÊñá‰ª∂Â§π');
                return;
            }

            // Â°´ÂÖÖÂΩìÂâçÊñá‰ª∂Â§π‰ø°ÊÅØ
            nameInput.value = folder.name || '';
            descriptionInput.value = folder.description || '';

            // Â≠òÂÇ®ÂΩìÂâçÁºñËæëÁöÑÊñá‰ª∂Â§πID
            modal.dataset.folderId = folderId;

            // ÊòæÁ§∫Ê®°ÊÄÅÊ°Ü
            modal.classList.add('show');

            // ËÅöÁÑ¶Âà∞ÂêçÁß∞ËæìÂÖ•Ê°Ü
            setTimeout(() => {
                nameInput.focus();
                nameInput.select();
            }, 100);
        }

        /**
         * ÂàùÂßãÂåñÈáçÂëΩÂêçÊñá‰ª∂Â§πÊ®°ÊÄÅÊ°Ü‰∫ã‰ª∂
         */
        function initRenameFolderModalEvents() {
            const modal = document.getElementById('renameFolderModal');
            const closeBtn = document.getElementById('renameModalClose');
            const cancelBtn = document.getElementById('renameModalCancel');
            const confirmBtn = document.getElementById('renameModalConfirm');
            const nameInput = document.getElementById('renameFolderName');

            // ÂÖ≥Èó≠ÊåâÈíÆ‰∫ã‰ª∂
            if (closeBtn) {
                closeBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            }

            // ÂèñÊ∂àÊåâÈíÆ‰∫ã‰ª∂
            if (cancelBtn) {
                cancelBtn.addEventListener('click', () => {
                    modal.classList.remove('show');
                });
            }

            // Á°ÆËÆ§ÊåâÈíÆ‰∫ã‰ª∂
            if (confirmBtn) {
                confirmBtn.addEventListener('click', () => {
                    const folderId = modal.dataset.folderId;
                    const newName = nameInput.value.trim();
                    const newDescription = document.getElementById('renameFolderDescription').value.trim();

                    // È™åËØÅËæìÂÖ•
                    if (!newName) {
                        alert('ËØ∑ËæìÂÖ•Êñá‰ª∂Â§πÂêçÁß∞');
                        nameInput.focus();
                        return;
                    }

                    if (newName.length > 100) {
                        alert('Êñá‰ª∂Â§πÂêçÁß∞‰∏çËÉΩË∂ÖËøá100‰∏™Â≠óÁ¨¶');
                        nameInput.focus();
                        return;
                    }

                    if (newDescription.length > 500) {
                        alert('Êñá‰ª∂Â§πÊèèËø∞‰∏çËÉΩË∂ÖËøá500‰∏™Â≠óÁ¨¶');
                        document.getElementById('renameFolderDescription').focus();
                        return;
                    }

                    // Ë∞ÉÁî®ÈáçÂëΩÂêçÂáΩÊï∞
                    renameFolder(folderId, newName, newDescription);
                });
            }

            // ÂõûËΩ¶ÈîÆÁ°ÆËÆ§
            if (nameInput) {
                nameInput.addEventListener('keypress', (e) => {
                    if (e.key === 'Enter') {
                        confirmBtn.click();
                    }
                });
            }

            // ÁÇπÂáªÊ®°ÊÄÅÊ°ÜÂ§ñÈÉ®ÂÖ≥Èó≠
            window.addEventListener('click', (event) => {
                if (event.target === modal) {
                    modal.classList.remove('show');
                }
            });
        }

        /**
         * ÈáçÂëΩÂêçÊñá‰ª∂Â§π
         */
        async function renameFolder(folderId, newName, newDescription) {
            try {
                const response = await fetch(`/api/folders/${folderId}`, {
                    method: 'PUT',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include',
                    body: JSON.stringify({
                        name: newName,
                        description: newDescription
                    })
                });

                const data = await response.json();

                if (response.ok) {
                    // ÂÖ≥Èó≠Ê®°ÊÄÅÊ°Ü
                    document.getElementById('renameFolderModal').classList.remove('show');

                    // ÈáçÊñ∞Âä†ËΩΩÊï∞ÊçÆ
                    loadFoldersAndDocuments(currentPage);

                    // Êõ¥Êñ∞Èù¢ÂåÖÂ±ëÂØºËà™ÔºàÂ¶ÇÊûúÂΩìÂâçÂú®Ëøô‰∏™Êñá‰ª∂Â§πÂÜÖÔºâ
                    if (currentFolderId === folderId) {
                        renderBreadcrumb();
                        // Êõ¥Êñ∞È°µÈù¢Ê†áÈ¢ò
                        const pageTitle = document.querySelector('.page-title');
                        const pageSubtitle = document.querySelector('.page-subtitle');
                        if (pageTitle) {
                            pageTitle.textContent = newName;
                        }
                        if (pageSubtitle) {
                            pageSubtitle.textContent = `Êü•ÁúãÊñá‰ª∂Â§π "${newName}" ‰∏≠ÁöÑÊñáÊ°£`;
                        }
                    }
                } else {
                    alert(`ÈáçÂëΩÂêçÊñá‰ª∂Â§πÂ§±Ë¥•: ${data.error}`);
                }
            } catch (error) {
                console.error('Error renaming folder:', error);
                alert('ÈáçÂëΩÂêçÊñá‰ª∂Â§πÊó∂ÂèëÁîüÁΩëÁªúÈîôËØØ');
            }
        }

        // Mobile menu functionality
        function initMobileMenu() {
            const menuToggle = document.getElementById('menuToggle');
            const mobileMenu = document.getElementById('mobileMenu');
            const mobileLogoutBtn = document.getElementById('mobileLogoutBtn');

            // Toggle mobile menu
            menuToggle.addEventListener('click', () => {
                mobileMenu.classList.toggle('active');
            });

            // Close menu when clicking links
            const mobileLinks = mobileMenu.querySelectorAll('.mobile-nav-link');
            mobileLinks.forEach(link => {
                link.addEventListener('click', () => {
                    mobileMenu.classList.remove('active');
                });
            });

            // Mobile logout functionality
            mobileLogoutBtn.addEventListener('click', async () => {
                await handleLogout();
            });

            // Close menu when clicking outside
            document.addEventListener('click', (event) => {
                if (!menuToggle.contains(event.target) && !mobileMenu.contains(event.target)) {
                    mobileMenu.classList.remove('active');
                }
            });
        }

        // Logout functionality
        async function handleLogout() {
            try {
                const response = await fetch('/api/auth/logout', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    credentials: 'include'
                });

                if (response.ok) {
                    window.location.href = '/login/';
                } else {
                    alert('Logout failed');
                }
            } catch (error) {
                console.error('Logout error:', error);
                alert('Network error during logout');
            }
        }
    </script>
</body>
</html>